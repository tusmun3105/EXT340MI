{"programModules":{"EXT340MI":{"program":"EXT340MI","triggers":{},"transactions":{"LstSupplSummary":{"sourceUuid":"40546a51-f21b-41dc-8029-58dc97c3458e","name":"LstSupplSummary","program":"EXT340MI","description":"Lst suppl summary","active":true,"multi":true,"modified":1731658996456,"modifiedBy":"KMOTEAN","outputFields":[{"name":"CUNO","description":"customer","length":10,"mandatory":false,"type":"A"},{"name":"POP4","description":"Référence normalisée de l’article ","length":15,"mandatory":false,"type":"A"},{"name":"POP5","description":"Référence non normalisée de l’article ","length":15,"mandatory":false,"type":"A"},{"name":"CFI1","description":"Code marque (ACR ou partenaire) ","length":10,"mandatory":false,"type":"A"},{"name":"ITNO","description":"item number","length":15,"mandatory":false,"type":"A"},{"name":"ORQA","description":"ordered quantity - alternate U/M","length":15,"mandatory":false,"type":"N"},{"name":"ORTP","description":"customer order type","length":3,"mandatory":false,"type":"A"},{"name":"SPLM","description":"supply model","length":8,"mandatory":false,"type":"A"},{"name":"WHLO","description":"warehouse","length":3,"mandatory":false,"type":"A"},{"name":"AV01","description":"Quantité disponible en stock ","length":15,"mandatory":false,"type":"N"},{"name":"WHNM","description":"description","length":36,"mandatory":false,"type":"A"},{"name":"TOMU","description":"issue multiple","length":15,"mandatory":false,"type":"N"},{"name":"PADL","description":"partial delivery","length":1,"mandatory":false,"type":"N"},{"name":"BCKO","description":"backorder","length":1,"mandatory":false,"type":"N"},{"name":"ROUT","description":"route","length":6,"mandatory":false,"type":"A"},{"name":"TX40","description":"description","length":40,"mandatory":false,"type":"A"},{"name":"CODZ","description":"confirmed delivery date","length":8,"mandatory":false,"type":"N"},{"name":"COHZ","description":"confirmed delivery time","length":4,"mandatory":false,"type":"N"},{"name":"IDEX","description":"Numerotation","length":5,"mandatory":false,"type":"A"},{"name":"TEST","description":"TEST","length":0,"mandatory":false,"type":"A"},{"name":"DSDT","description":"departure date","length":8,"mandatory":false,"type":"N"},{"name":"RODN","description":"route departure","length":3,"mandatory":false,"type":"N"},{"name":"DSHM","description":"departure time","length":4,"mandatory":false,"type":"N"},{"name":"IDWH","description":"Priorité dépôt","length":10,"mandatory":false,"type":"A"}],"inputFields":[{"name":"CUNO","description":"customer","length":10,"mandatory":true,"type":"A"},{"name":"ITNO","description":"item number","length":15,"mandatory":false,"type":"A"},{"name":"POP4","description":"Référence normalisée de l’article ","length":15,"mandatory":false,"type":"A"},{"name":"POP5","description":"Référence non normalisée de l’article ","length":15,"mandatory":false,"type":"A"},{"name":"CFI1","description":"Code marque (ACR ou partenaire) ","length":10,"mandatory":false,"type":"A"},{"name":"ORQA","description":"ordered quantity - alternate U/M","length":15,"mandatory":false,"type":"N"},{"name":"WHLO","description":"warehouse","length":3,"mandatory":false,"type":"A"},{"name":"ROUT","description":"route","length":6,"mandatory":false,"type":"A"},{"name":"SPLM","description":"supply model","length":8,"mandatory":false,"type":"A"},{"name":"PADL","description":"partial delivery","length":1,"mandatory":false,"type":"N"},{"name":"BCKO","description":"backorder","length":1,"mandatory":false,"type":"N"},{"name":"OALT","description":"Options de recherche d’alternative ","length":1,"mandatory":false,"type":"N"}],"utilities":[],"market":"ALL"}},"batches":{},"advancedPrograms":{}}},"utilities":{},"sources":{"40546a51-f21b-41dc-8029-58dc97c3458e":{"uuid":"40546a51-f21b-41dc-8029-58dc97c3458e","updated":1731667568299,"updatedBy":"KMOTEAN","created":1723064008023,"createdBy":"TMUNGUL","apiVersion":"0.21","beVersion":"16.0.0.20240916174523.6","language":"GROOVY","codeHash":"C125494514C6AE1F7BD0B997C7F4EC2087CF0E1BCF67B11D610512CF675DA762","code":"ICAgIC8qKg0KICAgKiAgQE5hbWU6IEVYVDM0ME1JLkxzdFN1cHBsU3VtbWFyeQ0KICAgKiAgQERlc2NyaXB0aW9uOiBEaXNwb25pYmlsaXTDqSwgUHJpeCBldCBEw6lsYWkNCiAgICogIEBBdXRob3JzOiBUdXNoYWFyIE11bmd1bA0KICAgKi8NCiAgDQogIC8qKg0KICAgKiBDSEFOR0VMT0dTDQogICAqIFZlcnNpb24gICAgRGF0ZSAgICBVc2VyICAgICAgICBEZXNjcmlwdGlvbg0KICAgKiAxLjAuMCAgICAgIDI4MDgyNCAgS01PVEVBTiAgICAgSW5pdGlhbCBSZWxlYXNlDQogICAqLw0KICAgDQppbXBvcnQgamF2YS50ZXh0LlNpbXBsZURhdGVGb3JtYXQNCmltcG9ydCBqYXZhLnRpbWUuTG9jYWxEYXRlVGltZQ0KaW1wb3J0IGphdmEudGltZS5mb3JtYXQuRGF0ZVRpbWVGb3JtYXR0ZXINCmltcG9ydCBqYXZhLnRpbWUuZm9ybWF0LkRhdGVUaW1lUGFyc2VFeGNlcHRpb24NCmltcG9ydCBqYXZhLnRpbWUuTG9jYWxEYXRlDQoNCnB1YmxpYyBjbGFzcyBMc3RTdXBwbFN1bW1hcnkgZXh0ZW5kcyBFeHRlbmRNM1RyYW5zYWN0aW9uIHsNCiAgcHJpdmF0ZSBmaW5hbCBNSUFQSSBtaTsNCiAgcHJpdmF0ZSBmaW5hbCBEYXRhYmFzZUFQSSBkYXRhYmFzZTsNCiAgcHJpdmF0ZSBmaW5hbCBQcm9ncmFtQVBJIHByb2dyYW07DQogIHByaXZhdGUgZmluYWwgTUlDYWxsZXJBUEkgbWlDYWxsZXI7DQogIHByaXZhdGUgU3RyaW5nIGluQ1VOTzsNCiAgcHJpdmF0ZSBTdHJpbmcgaW5JVE5POw0KICBwcml2YXRlIFN0cmluZyBpblBPUDQ7DQogIHByaXZhdGUgU3RyaW5nIGluUE9QNTsNCiAgcHJpdmF0ZSBTdHJpbmcgaW5DRkkxOw0KICBwcml2YXRlIGRvdWJsZSBpbk9SUUE7DQogIHByaXZhdGUgU3RyaW5nIGluV0hMTzsNCiAgcHJpdmF0ZSBTdHJpbmcgaW5ST1VUOw0KICBwcml2YXRlIFN0cmluZyBpblNQTE07DQogIHByaXZhdGUgaW50IGluUEFETDsNCiAgcHJpdmF0ZSBpbnQgaW5CQ0tPOw0KICBwcml2YXRlIGludCBpbk9BTFQ7DQogIHByaXZhdGUgU3RyaW5nIElUTk9mcm9tTU1TMDI1PSIiOw0KICBwcml2YXRlIExpc3Q8TWFwPFN0cmluZywgU3RyaW5nPj4gbGlzdHJlc3BvbnNlTU1TMDI1R2xvYmFsID0gW10NCiAgcHJpdmF0ZSBMaXN0PE1hcDxTdHJpbmcsIFN0cmluZz4+IGxpc3RyZXNwb25zZUNSUzYxMF9HZXRPcmRlckluZm9HbG9iYWwgPSBbXQ0KICBwcml2YXRlIExpc3Q8TWFwPFN0cmluZywgU3RyaW5nPj4gbGlzdHJlc3BvbnNlTU1TMDA1X0dldFdhcmVob3VzZUdsb2JhbCA9IFtdDQogIHByaXZhdGUgTGlzdDxNYXA8U3RyaW5nLCBTdHJpbmc+PiBsaXN0cmVzcG9uc2VNTVMyMDBfR2V0U3VtV2hzQmFsR2xvYmFsID0gW10NCiAgcHJpdmF0ZSBMaXN0PE1hcDxTdHJpbmcsIFN0cmluZz4+IGxpc3RyZXNwb25zZU1NUzIwMF9HZXRHbG9iYWwgPSBbXQ0KICBwcml2YXRlIExpc3Q8TWFwPFN0cmluZywgU3RyaW5nPj4gbGlzdHJlc3BvbnNlRFJTMDA1X0dldFJvdXRlR2xvYmFsID0gW10NCiAgcHJpdmF0ZSBMaXN0PE1hcDxTdHJpbmcsIFN0cmluZz4+IGxpc3RyZXNwb25zZURSUzAwNl9Mc3RHbG9iYWwgPSBbXQ0KICBwcml2YXRlICBkZWYgTGlzdDxNYXA8U3RyaW5nLCBTdHJpbmc+PiBsaXN0cmVzcG9uc2VNTVMwNTlfTGlzdEdsb2JhbCA9IFtdDQogIHByaXZhdGUgIGRlZiBMaXN0PE1hcDxTdHJpbmcsIFN0cmluZz4+IGFycmF5b2ZQbGFjZW9mTG9hZGluZyA9IFtdDQogIHByaXZhdGUgIGRlZiBMaXN0PE1hcDxTdHJpbmcsIFN0cmluZz4+IGFycmF5T0ZSb3V0ZXMgPSBbXQ0KICBwcml2YXRlICBkZWYgTGlzdDxNYXA8U3RyaW5nLCBTdHJpbmc+PiBhcnJheU9GUm91dGVzQWxsb3dmb3JDdW5vID0gW10NCiAgcHJpdmF0ZSAgZGVmIExpc3Q8TWFwPFN0cmluZywgU3RyaW5nPj4gYXJyYXlPRkR1cmF0aW9uID0gW10NCiAgcHJpdmF0ZSAgZGVmIExpc3Q8TWFwPFN0cmluZywgU3RyaW5nPj4gYXJyYXlPRldhcmVob3VzZVFUWSA9IFtdDQogIHByaXZhdGUgTGlzdDxNYXA8U3RyaW5nLCBTdHJpbmc+PiBsaXN0cmVzcG9uc2VEUlMwNDVfR2V0VElaT0RhdGFHbG9iYWwgPSBbXQ0KICBwcml2YXRlIGRlZiB1bmlxdWVEYXRhDQoNCiAgcHJpdmF0ZSBkZWYgZmluYWxCaWdBcnJheT1bXQ0KICBwcml2YXRlIGRlZiB1cGRhdGVkQXJyYXk9W10NCiAgcHJpdmF0ZSBTdHJpbmcgdGltZVpvbmVEYXRlQW5kVGltZT0iIg0KICANCiAgcHJpdmF0ZSBTdHJpbmcgZGF0ZVRpbWVab25lPSIiIA0KICBwcml2YXRlIFN0cmluZyB0aW1lVGltZVpvbmU9IiIgDQoNCiAgcHJpdmF0ZSBMaXN0PFN0cmluZz4gZGlzdGluY3RGV0hMVmFsdWVzDQogIA0KICBwcml2YXRlIFN0cmluZyBPUlRQNjEwPSIiDQogIHByaXZhdGUgU3RyaW5nIFdITE82MTA9IiINCiAgcHJpdmF0ZSBTdHJpbmcgU1BMTTYxMD0iIg0KICBwcml2YXRlIFN0cmluZyBQQURMNjEwPSIiDQogIHByaXZhdGUgU3RyaW5nIEJDS082MTA9IiINCiAgcHJpdmF0ZSBTdHJpbmcgVE9NVV9NTVMyMDA9IiINCiAgcHJpdmF0ZSBTdHJpbmcgUEFETDYxMF8wNTk9IiINCiAgcHJpdmF0ZSBTdHJpbmcgQkNLTzYxMF8wNTk9IiINCiAgcHJpdmF0ZSBTdHJpbmcgSVROT3BvcDVvcjQ9IiINCiAgcHJpdmF0ZSBTdHJpbmcgQVYwMV9NTVMyMDA9IiINCiAgcHJpdmF0ZSBTdHJpbmcgV0hOTV9NTVMyMDA9IiINCiAgDQogIHB1YmxpYyBMc3RTdXBwbFN1bW1hcnkoTUlBUEkgbWksIERhdGFiYXNlQVBJIGRhdGFiYXNlLCBQcm9ncmFtQVBJIHByb2dyYW0sIE1JQ2FsbGVyQVBJIG1pQ2FsbGVyKSB7DQogICAgdGhpcy5taSA9IG1pOw0KICAgIHRoaXMuZGF0YWJhc2UgPSBkYXRhYmFzZTsNCiAgICB0aGlzLnByb2dyYW0gPSBwcm9ncmFtOw0KICAgIHRoaXMubWlDYWxsZXIgPSBtaUNhbGxlcjsNCiAgfQ0KICANCiAgcHVibGljIHZvaWQgbWFpbigpIHsNCiAgICAgDQogICAgIGluaXRpYWxpemVJbnB1dCgpOw0KDQogICAgIA0KICAgIC8vZ2V0IHRpbWUgdGltZVpvbmVEYXRlQW5kVGltZQ0KICAgICBEUlMwNDVfTGlzdEFwaUNhbGwocHJvZ3JhbS5MREFaRC5USVpPLnRvU3RyaW5nKCkpDQogICAgICAgICAgaWYoIWxpc3RyZXNwb25zZURSUzA0NV9HZXRUSVpPRGF0YUdsb2JhbC5pc0VtcHR5KCkpew0KICAgICAgICAgICBkYXRlVGltZVpvbmUgPSBsaXN0cmVzcG9uc2VEUlMwNDVfR2V0VElaT0RhdGFHbG9iYWxbMF0uREFURS50cmltKCk7DQogICAgICAgICAgIHRpbWVUaW1lWm9uZSA9IGxpc3RyZXNwb25zZURSUzA0NV9HZXRUSVpPRGF0YUdsb2JhbFswXS5USU1FLnN1YnN0cmluZygwLCA0KS50cmltKCk7DQogICAgICAgICAgfQ0KICAgICAgICAgIA0KICAgICBDUlM2MTBfR2V0T3JkZXJJbmZvQXBpQ2FsbChpbkNVTk8pOw0KICAgICANCiAgICAgaWYoIWxpc3RyZXNwb25zZUNSUzYxMF9HZXRPcmRlckluZm9HbG9iYWwuaXNFbXB0eSgpKXsNCiAgICAgICAgICBPUlRQNjEwID0gbGlzdHJlc3BvbnNlQ1JTNjEwX0dldE9yZGVySW5mb0dsb2JhbFswXS5PUlRQOw0KICAgICAgICAgIFNQTE02MTAgPSBsaXN0cmVzcG9uc2VDUlM2MTBfR2V0T3JkZXJJbmZvR2xvYmFsWzBdLlNQTE07DQogICAgICAgICAgV0hMTzYxMCA9IGxpc3RyZXNwb25zZUNSUzYxMF9HZXRPcmRlckluZm9HbG9iYWxbMF0uV0hMTzsNCiAgICAgICAgICBQQURMNjEwID0gbGlzdHJlc3BvbnNlQ1JTNjEwX0dldE9yZGVySW5mb0dsb2JhbFswXS5QQURMOw0KICAgICAgICAgIEJDS082MTAgPSBsaXN0cmVzcG9uc2VDUlM2MTBfR2V0T3JkZXJJbmZvR2xvYmFsWzBdLkJDS087DQogICAgICAgICAgDQogICAgIH1lbHNlew0KICAgICAgICAgIG1pLmVycm9yKCJDdXN0b21lciAiK2luQ1VOTysiIGRvZXMgbm90IGV4aXN0Iik7DQogICAgICAgICAgcmV0dXJuOw0KICAgICB9DQoNCiAgIA0KICBpZihpbklUTk8hPSIiKXsNCiAgICBib29sZWFuIGNoZWNrSXRlbSA9IE1NUzIwMF9HZXRBcGlDYWxsKGluSVROTykNCiAgICBpZihjaGVja0l0ZW0hPXRydWUpew0KICAgICAgbWkuZXJyb3IoIkl0ZW0gIitpbklUTk8rICIgZG9lcyBub3QgZXhpc3QiKQ0KICAgICAgcmV0dXJuDQogICAgfQ0KICB9DQogICANCiAgIA0KICAgICAgICBjaGVja0JDS09fUEFETF9PQUxUX1BPUDRfUE9QNSgpOw0KICAgICBpZiAoIWlzVmFsaWRQT1A1X1BPNCgpKSByZXR1cm4NCiAgICAgDQogICAgIGlmICghZ2V0SXRlbU51bWJlcigpKSByZXR1cm4NCg0KICAgIA0KICAgIGlmKGluV0hMTyE9IiIpew0KICAgICAgY2hlY2tXYXJlaG91c2VFeGlzdChpbldITE8pDQogICAgIGlmIChsaXN0cmVzcG9uc2VNTVMwMDVfR2V0V2FyZWhvdXNlR2xvYmFsLmlzRW1wdHkoKSl7DQogICAgICAgbWkuZXJyb3IoIldhcmVob3VzZSAiK2luV0hMTy50cmltKCkrIiBkb2VzIG5vdCBleGlzdCIpDQogICAgICAgcmV0dXJuDQogICAgIH0NCiAgICBpZldITE9pc25vdEVtcHR5KGluV0hMTy50cmltKCkpDQogICAgICAgICAgfQ0KICAgIGVsc2UgaWYoaW5PQUxUPT0yKXsNCiAgICBpZldITE9pc25vdEVtcHR5KFdITE82MTApDQogICAgICB9DQogICAgICBlbHNlIGlmKGluU1BMTS50cmltKCk9PSIiKXsNCiAgICBpZldITE9pc25vdEVtcHR5KFdITE82MTApDQogICAgICB9DQogICAgICBlbHNlIGlmKGluT0FMVD09MSl7DQogICAgaWZXSExPaXNub3RFbXB0eSgiIikNCiAgICAgIH0NCiAgICAgIGVsc2UgaWYoaW5PQUxUPT0wKXsNCiAgICBpZldITE9pc25vdEVtcHR5KCIiKQ0KICAgICAgfSANCiAgICAgIA0KDQoNCiAgICAgDQogIH0NCiAgDQogIHZvaWQgaW5pdGlhbGl6ZUlucHV0KCl7DQogICAgIGluQ1VOTyA9IG1pLmluRGF0YS5nZXQoIkNVTk8iKSA9PSBudWxsID8gIiIgOiBtaS5pbkRhdGEuZ2V0KCJDVU5PIikudHJpbSgpOw0KICAgICBpbklUTk8gPSBtaS5pbkRhdGEuZ2V0KCJJVE5PIikgPT0gbnVsbCA/ICIiIDogbWkuaW5EYXRhLmdldCgiSVROTyIpLnRyaW0oKTsNCiAgICAgaW5QT1A0ID0gbWkuaW5EYXRhLmdldCgiUE9QNCIpID09IG51bGwgPyAiIiA6IG1pLmluRGF0YS5nZXQoIlBPUDQiKS50cmltKCk7DQogICAgIGluUE9QNSA9IG1pLmluRGF0YS5nZXQoIlBPUDUiKSA9PSBudWxsID8gIiIgOiBtaS5pbkRhdGEuZ2V0KCJQT1A1IikudHJpbSgpOw0KICAgICBpbkNGSTEgPSBtaS5pbkRhdGEuZ2V0KCJDRkkxIikgPT0gbnVsbCA/ICIiIDogbWkuaW5EYXRhLmdldCgiQ0ZJMSIpLnRyaW0oKTsNCiAgICAgaW5PUlFBID0gbWkuaW4uZ2V0KCJPUlFBIikgPT0gbnVsbCA/IC0xLjAgYXMgZG91YmxlOiBtaS5pbi5nZXQoIk9SUUEiKSBhcyBEb3VibGU7DQogICAgIGluV0hMTyA9IG1pLmluRGF0YS5nZXQoIldITE8iKSA9PSBudWxsID8gIiIgOiBtaS5pbkRhdGEuZ2V0KCJXSExPIikudHJpbSgpOw0KICAgICBpblJPVVQgPSBtaS5pbkRhdGEuZ2V0KCJST1VUIikgPT0gbnVsbCA/ICIiIDogbWkuaW5EYXRhLmdldCgiUk9VVCIpLnRyaW0oKTsNCiAgICAgaW5TUExNID0gbWkuaW5EYXRhLmdldCgiU1BMTSIpID09IG51bGwgPyAiIiA6IG1pLmluRGF0YS5nZXQoIlNQTE0iKS50cmltKCk7DQogICAgIGluUEFETCA9IG1pLmluLmdldCgiUEFETCIpID09IG51bGwgPyAtMSBhcyBJbnRlZ2VyIDogbWkuaW4uZ2V0KCJQQURMIikgYXMgSW50ZWdlcjsNCiAgICAgaW5CQ0tPID0gbWkuaW4uZ2V0KCJCQ0tPIikgPT0gbnVsbCA/IC0xIGFzIEludGVnZXIgOiBtaS5pbi5nZXQoIkJDS08iKSBhcyBJbnRlZ2VyOw0KICAgICBpbk9BTFQgPSBtaS5pbi5nZXQoIk9BTFQiKSA9PSBudWxsID8gMCBhcyBJbnRlZ2VyIDogbWkuaW4uZ2V0KCJPQUxUIikgYXMgSW50ZWdlcjsNCiAgfQ0KICANCiAgICAgIHZvaWQgY2hlY2tCQ0tPX1BBRExfT0FMVF9QT1A0X1BPUDUoKSB7DQogICAgICAgIGlmIChpblBBREwgIT0gMCAmJiBpblBBREwgIT0gMSAmJiBpblBBREwgIT0gLTEpIHsNCiAgICAgICAgICAgIG1pLmVycm9yKCJQQURMIGNhbiBlaXRoZXIgYmUgMCBvciAxIik7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0gZWxzZSBpZiAoaW5CQ0tPICE9IDAgJiYgaW5CQ0tPICE9IDEgJiYgaW5CQ0tPICE9IC0xKSB7DQogICAgICAgICAgICBtaS5lcnJvcigiQkNLTyBjYW4gZWl0aGVyIGJlIDAgb3IgMSIpOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9IGVsc2UgaWYgKGluT0FMVCAhPSAwICYmIGluT0FMVCAhPSAxICYmIGluT0FMVCAhPSAyICYmIGluT0FMVCAhPSAtMSkgew0KICAgICAgICAgICAgbWkuZXJyb3IoIk9BTFQgY2FuIGVpdGhlciBiZSAwLCAxIG9yIDIiKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfSANCiAgICAgICAgLy8gZWxzZSBpZiAoaW5QT1A0ID09ICIiICYmIGluUE9QNSA9PSAiIikgew0KICAgICAgICAvLyAgICAgbWkuZXJyb3IoIkVpdGhlciBQT1A0IG9yIFBPUDUgbmVlZHMgdG8gYmUgYXNzaWduZWQiKTsNCiAgICAgICAgLy8gICAgIHJldHVybjsNCiAgICAgICAgLy8gfQ0KICAgIH0NCiAgICANCiAgICAgIGJvb2xlYW4gaXNWYWxpZFBPUDVfUE80KCkgew0KICAgICAgaWYoaW5QT1A0LnRyaW0oKSE9IiIpew0KICAgICAgICBNTVMwMjVBcGlDYWxsKGluUE9QNC50cmltKCksICI0Iik7DQogICAgICAgIGlmKGxpc3RyZXNwb25zZU1NUzAyNUdsb2JhbC5pc0VtcHR5KCkpew0KICAgICAgICAgIG1pLmVycm9yKCJBbGlhcyBudW1iZXIgIitpblBPUDQrIiB3aXRoIEFsaWFzIGNhdGVnb3J5IDQgZG9lcyBub3QgZXhpc3QiKQ0KICAgICAgICAgIHJldHVybiBmYWxzZQ0KICAgICAgICB9DQogICAgICB9DQogICAgICBpZihpblBPUDUudHJpbSgpIT0iIil7DQogICAgICAgIE1NUzAyNUFwaUNhbGwoaW5QT1A1LnRyaW0oKSwgIjUiKTsNCiAgICAgICAgaWYobGlzdHJlc3BvbnNlTU1TMDI1R2xvYmFsLmlzRW1wdHkoKSl7DQogICAgICAgICAgbWkuZXJyb3IoIkFsaWFzIG51bWJlciAiK2luUE9QNSsiIHdpdGggQWxpYXMgY2F0ZWdvcnkgNSBkb2VzIG5vdCBleGlzdCIpDQogICAgICAgICAgcmV0dXJuIGZhbHNlDQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHJldHVybiB0cnVlDQogICAgfQ0KICAgIA0KICAgICAgdm9pZCBjaGVja1dhcmVob3VzZUV4aXN0KFN0cmluZyB3aGxvKSB7DQogICAgICAgICAgICBkZWYgcGFyYW1zTU1TMDA1ID0gWyJXSExPIjogIiR7d2hsb30iLnRvU3RyaW5nKCldDQogICAgDQogICAgICAgICAgICBkZWYgY2FsbGJhY2tNTVMwMDUgPSB7IE1hcDxTdHJpbmcsIFN0cmluZz4gcmVzcG9uc2VNTVMwMDUgLT4NCiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2VNTVMwMDUhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZU1NUzAwNS5jb250YWluc0tleSgiZXJyb3IiKSAmJiByZXNwb25zZU1NUzAwNS5lcnJvciAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBsaXN0cmVzcG9uc2VNTVMwMDVfR2V0V2FyZWhvdXNlR2xvYmFsLmFkZChyZXNwb25zZU1NUzAwNSkNCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgbWlDYWxsZXIuY2FsbCgiTU1TMDA1TUkiLCAiR2V0V2FyZWhvdXNlIiwgcGFyYW1zTU1TMDA1LCBjYWxsYmFja01NUzAwNSkNCiAgICAgICAgICAgIA0KICAgIH0gICANCiAgICANCiAgICB2b2lkIENSUzYxMF9HZXRPcmRlckluZm9BcGlDYWxsKFN0cmluZyBjdW5vKSB7DQogICAgICAgICAgICBkZWYgcGFyYW1zQ1JTNjEwID0gWyJDVU5PIjogIiR7Y3Vub30iLnRvU3RyaW5nKCldDQogICAgDQogICAgICAgICAgICBkZWYgY2FsbGJhY2tDUlM2MTAgPSB7IE1hcDxTdHJpbmcsIFN0cmluZz4gcmVzcG9uc2VDUlM2MTAgLT4NCiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2VDUlM2MTAgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2VDUlM2MTAuY29udGFpbnNLZXkoImVycm9yIikgJiYgcmVzcG9uc2VDUlM2MTAuZXJyb3IgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgbGlzdHJlc3BvbnNlQ1JTNjEwX0dldE9yZGVySW5mb0dsb2JhbC5hZGQocmVzcG9uc2VDUlM2MTApDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBtaUNhbGxlci5jYWxsKCJDUlM2MTBNSSIsICJHZXRPcmRlckluZm8iLCBwYXJhbXNDUlM2MTAsIGNhbGxiYWNrQ1JTNjEwKQ0KICAgICAgICB9DQogICAgICAgIA0KICAgIHZvaWQgTU1TMDI1QXBpQ2FsbChTdHJpbmcgcG9wbiwgU3RyaW5nIGFsd3QpIHsNCiAgICAgICAgDQogICAgICAgIGRlZiBwYXJhbXNNTVMwMjUgPSBbIlBPUE4iOiAiJHtwb3BufSIudG9TdHJpbmcoKSwgIkFMV1QiOiAiJHthbHd0fSIudG9TdHJpbmcoKV0NCg0KICAgICAgICBkZWYgY2FsbGJhY2tNTVMwMjUgPSB7IE1hcDxTdHJpbmcsIFN0cmluZz4gcmVzcG9uc2VNTVMwMjUgLT4NCiAgICAgICAgICAgIGlmIChyZXNwb25zZU1NUzAyNSAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZU1NUzAyNS5jb250YWluc0tleSgiZXJyb3IiKSAmJiByZXNwb25zZU1NUzAyNS5lcnJvciAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBsaXN0cmVzcG9uc2VNTVMwMjVHbG9iYWwuYWRkKHJlc3BvbnNlTU1TMDI1KQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgbWlDYWxsZXIuY2FsbCgiTU1TMDI1TUkiLCAiTHN0SXRlbSIsIHBhcmFtc01NUzAyNSwgY2FsbGJhY2tNTVMwMjUpDQogICAgfQ0KICAgIA0KICAgIGJvb2xlYW4gZ2V0SXRlbU51bWJlcigpew0KICAgICAgICAgICBpZihpblBPUDQhPSIiKXsNCiAgICAgICAgICAgICBNTVMwMjVBcGlDYWxsKGluUE9QNCwgIjQiKTsNCiAgICAgICAgICAgICBpZihsaXN0cmVzcG9uc2VNTVMwMjVHbG9iYWwuaXNFbXB0eSgpKXsNCiAgICAgICAgICAgICAgbWkuZXJyb3IoIkFsaWFzIE51bWJlciAiK2luUE9QNCsiIGluZXhpc3RhbnQgZm9yIEFsaWFzIGNhdGVnb3J5ICIrIjQiKTsNCiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgfQ0KICAgICAgICAgICB9DQogICAgICAgICAgIGVsc2UgaWYoaW5QT1A1IT0iIil7DQogICAgICAgICAgICBNTVMwMjVBcGlDYWxsKGluUE9QNSwgIjUiKTsNCiAgICAgICAgICAgICBpZihsaXN0cmVzcG9uc2VNTVMwMjVHbG9iYWwuaXNFbXB0eSgpKXsNCiAgICAgICAgICAgICAgbWkuZXJyb3IoIkFsaWFzIE51bWJlciAiK2luUE9QNSsiIGluZXhpc3RhbnQgZm9yIEFsaWFzIGNhdGVnb3J5ICIrIjUiKTsNCiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlICAgICAgICAgICAgICANCiAgICAgICAgICAgICB9ICAgICAgICAgICAgDQogICAgICAgICAgIH0NCiAgICAgICAgICBpZighbGlzdHJlc3BvbnNlTU1TMDI1R2xvYmFsLmlzRW1wdHkoKSl7DQogICAgICAgICAgICAgICBpZihpbklUTk8hPSIiKXsNCiAgICAgICAgICAgICAgICAgSVROT3BvcDVvcjQ9aW5JVE5PDQogICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICBlbHNlew0KICAgICAgICAgICAgICAgSVROT3BvcDVvcjQ9bGlzdHJlc3BvbnNlTU1TMDI1R2xvYmFsWzBdLklUTk87DQogICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWUNCiAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgIHJldHVybiB0cnVlDQogICAgICAgICAgfQ0KICAgICAgICAgIA0KICAgICAgICAgIA0KICAgIH0NCg0KICAgIGJvb2xlYW4gTU1TMjAwX0dldEFwaUNhbGwoU3RyaW5nIGl0bm8pIHsNCiAgICAgICAgICAgIGRlZiBwYXJhbXNNTVMyMDAgPSBbIklUTk8iOiAiJHtpdG5vfSIudG9TdHJpbmcoKV0NCiAgICANCiAgICAgICAgICAgIGRlZiBjYWxsYmFja01NUzIwMCA9IHsgTWFwPFN0cmluZywgU3RyaW5nPiByZXNwb25zZU1NUzIwMCAtPg0KICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZU1NUzIwMCAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZU1NUzIwMC5jb250YWluc0tleSgiZXJyb3IiKSAmJiByZXNwb25zZU1NUzIwMC5lcnJvciAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBsaXN0cmVzcG9uc2VNTVMyMDBfR2V0R2xvYmFsLmFkZChyZXNwb25zZU1NUzIwMCkNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIG1pQ2FsbGVyLmNhbGwoIk1NUzIwME1JIiwgIkdldCIsIHBhcmFtc01NUzIwMCwgY2FsbGJhY2tNTVMyMDApDQogICAgICAgICAgIGlmKGxpc3RyZXNwb25zZU1NUzIwMF9HZXRHbG9iYWwuc2l6ZSgpPjApew0KICAgICAgICAgICAgIHJldHVybiB0cnVlDQogICAgICAgICAgIH0NCiAgICAgICAgICAgZWxzZXsNCiAgICAgICAgICAgICByZXR1cm4gZmFsc2UNCiAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIA0KICAgIC8vIGJvb2xlYW4gTU1TMjAwX0dldFN1bVdoc0JhbEFwaUNhbGwoU3RyaW5nIHdobG8sIFN0cmluZyBpdG5vKSB7DQoNCiAgICAvLyAgICAgICAgIE1NUzIwMF9HZXRJdG1XaHNCYXNpY0FwaUNhbGwod2hsbywgaXRubyk7DQoNCiAgICAvLyAgICAgICBpZighbGlzdHJlc3BvbnNlTU1TMjAwX0dldEl0bVdoc0Jhc2ljR2xvYmFsLmlzRW1wdHkoKSl7DQogICAgLy8gICAgICAgICBUT01VX01NUzIwMD1saXN0cmVzcG9uc2VNTVMyMDBfR2V0SXRtV2hzQmFzaWNHbG9iYWxbMF0uVE9NVTsNCiAgICAvLyB9DQoNCiAgICAvLyAgICAgICAgIGRlZiBwYXJhbXNNTVMyMDAgPSBbIldITE8iOiAiJHt3aGxvfSIudG9TdHJpbmcoKSwgIlBPUE4iOiAiJHtpdG5vfSIudG9TdHJpbmcoKV0NCiAgICANCiAgICAvLyAgICAgICAgIGRlZiBjYWxsYmFja01NUzIwMCA9IHsgTWFwPFN0cmluZywgU3RyaW5nPiByZXNwb25zZU1NUzIwMCAtPg0KICAgIC8vICAgICAgICAgICAgIGlmIChyZXNwb25zZU1NUzIwMCAhPSBudWxsKSB7DQogICAgLy8gICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZU1NUzIwMC5jb250YWluc0tleSgiZXJyb3IiKSAmJiByZXNwb25zZU1NUzIwMC5lcnJvciAhPSBudWxsKSB7DQogICAgLy8gICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgLy8gICAgICAgICAgICAgICAgICAgICBsaXN0cmVzcG9uc2VNTVMyMDBfR2V0U3VtV2hzQmFsR2xvYmFsLmFkZChyZXNwb25zZU1NUzIwMCkNCiAgICAvLyAgICAgICAgICAgICAgICAgfQ0KICAgIC8vICAgICAgICAgICAgIH0NCiAgICAvLyAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgIC8vICAgICAgICAgbWlDYWxsZXIuY2FsbCgiTU1TMjAwTUkiLCAiR2V0U3VtV2hzQmFsIiwgcGFyYW1zTU1TMjAwLCBjYWxsYmFja01NUzIwMCkNCg0KICAgIC8vICAgICAgIGlmKCFsaXN0cmVzcG9uc2VNTVMyMDBfR2V0U3VtV2hzQmFsR2xvYmFsLmlzRW1wdHkoKSl7DQogICAgLy8gICAgICAgICAgIEFWMDFfTU1TMjAwID0gbGlzdHJlc3BvbnNlTU1TMjAwX0dldFN1bVdoc0JhbEdsb2JhbFswXS5BVjAxOw0KICAgIC8vICAgICAgICAgICBXSE5NX01NUzIwMCA9IGxpc3RyZXNwb25zZU1NUzIwMF9HZXRTdW1XaHNCYWxHbG9iYWxbMF0uV0hOTTsNCiAgICAvLyAgICAgICAgICAgcmV0dXJuIHRydWUNCiAgICAvLyB9ZWxzZXsNCiAgICAvLyAgIG1pLmVycm9yKCJXYXJlaG91c2UgIit3aGxvKyIgZG9lcyBub3QgZXhpc3QiKTsNCiAgICAvLyAgIHJldHVybiBmYWxzZQ0KICAgIC8vIH0NCiAgICAvLyB9DQogICAgDQogICAgdm9pZCBNTVMwNTlfTGlzdEFwaUNhbGwoU3RyaW5nIHNwbG0pIHsNCiAgICAgICAgICAgIGRlZiBwYXJhbXNNTVMwNTkgPSBbIlNQTE0iOiAiJHtzcGxtfSIudG9TdHJpbmcoKV0NCiAgICANCiAgICAgICAgICAgIGRlZiBjYWxsYmFja01NUzA1OSA9IHsgTWFwPFN0cmluZywgU3RyaW5nPiByZXNwb25zZU1NUzA1OSAtPg0KICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZU1NUzA1OSAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZU1NUzA1OS5jb250YWluc0tleSgiZXJyb3IiKSAmJiByZXNwb25zZU1NUzA1OS5lcnJvciAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBsaXN0cmVzcG9uc2VNTVMwNTlfTGlzdEdsb2JhbC5hZGQocmVzcG9uc2VNTVMwNTkpDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBtaUNhbGxlci5jYWxsKCJNTVMwNTlNSSIsICJMaXN0IiwgcGFyYW1zTU1TMDU5LCBjYWxsYmFja01NUzA1OSkNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgIHZvaWQgRFJTMDQ1X0xpc3RBcGlDYWxsKFN0cmluZyB0aXpvKSB7DQogICAgICAgICAgICBkZWYgcGFyYW1zRFJTMDQ1ID0gWyJUSVpPIjogIiR7dGl6b30iLnRvU3RyaW5nKCldDQogICAgDQogICAgICAgICAgICBkZWYgY2FsbGJhY2tEUlMwNDUgPSB7IE1hcDxTdHJpbmcsIFN0cmluZz4gcmVzcG9uc2VEUlMwNDUgLT4NCiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2VEUlMwNDUgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2VEUlMwNDUuY29udGFpbnNLZXkoImVycm9yIikgJiYgcmVzcG9uc2VEUlMwNDUuZXJyb3IgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgbGlzdHJlc3BvbnNlRFJTMDQ1X0dldFRJWk9EYXRhR2xvYmFsLmFkZChyZXNwb25zZURSUzA0NSkNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgIG1pQ2FsbGVyLmNhbGwoIkRSUzA0NU1JIiwgIkdldFRJWk9EYXRhIiwgcGFyYW1zRFJTMDQ1LCBjYWxsYmFja0RSUzA0NSkNCiAgICAgICAgfSANCg0KICAgIHZvaWQgRFJTMDA1X0dldFJvdXRlQXBpQ2FsbChTdHJpbmcgcm91dCkgew0KICAgICAgICAgICAgZGVmIHBhcmFtc0RSUzAwNSA9IFsiUk9VVCI6ICIke3JvdXR9Ii50b1N0cmluZygpXQ0KICAgIA0KICAgICAgICAgICAgZGVmIGNhbGxiYWNrRFJTMDA1ID0geyBNYXA8U3RyaW5nLCBTdHJpbmc+IHJlc3BvbnNlRFJTMDA1IC0+DQogICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlRFJTMDA1ICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlRFJTMDA1LmNvbnRhaW5zS2V5KCJlcnJvciIpICYmIHJlc3BvbnNlRFJTMDA1LmVycm9yICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxpc3RyZXNwb25zZURSUzAwNV9HZXRSb3V0ZUdsb2JhbC5hZGQocmVzcG9uc2VEUlMwMDUpDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgDQogICAgICAgICAgICBtaUNhbGxlci5jYWxsKCJEUlMwMDVNSSIsICJHZXRSb3V0ZSIsIHBhcmFtc0RSUzAwNSwgY2FsbGJhY2tEUlMwMDUpDQogICAgICAgIH0NCiAgICAgICAgDQogICAgdm9pZCBEUlMwMDZfTHN0QXBpQ2FsbChTdHJpbmcgcm91dCkgew0KICAgICAgICAgICAgZGVmIHBhcmFtc0RSUzAwNiA9IFsiUk9VVCI6ICIke3JvdXR9Ii50b1N0cmluZygpXQ0KICAgIA0KICAgICAgICAgICAgZGVmIGNhbGxiYWNrRFJTMDA2ID0geyBNYXA8U3RyaW5nLCBTdHJpbmc+IHJlc3BvbnNlRFJTMDA2IC0+DQogICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlRFJTMDA2ICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlRFJTMDA2LmNvbnRhaW5zS2V5KCJlcnJvciIpICYmIHJlc3BvbnNlRFJTMDA2LmVycm9yICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxpc3RyZXNwb25zZURSUzAwNl9Mc3RHbG9iYWwuYWRkKHJlc3BvbnNlRFJTMDA2KQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICAgICAgICAgbWlDYWxsZXIuY2FsbCgiRFJTMDA2TUkiLCAiTHN0IiwgcGFyYW1zRFJTMDA2LCBjYWxsYmFja0RSUzAwNikNCiAgICAgICAgfQ0KICAgICAgICANCiAgICB2b2lkIHJldHJpZXZlUGxhY2VPZkxvYWRpbmdGcm9tV2FyZWhvdXNlKFN0cmluZyB3aGxvKXsNCg0KICAgICAgICBpbnQgbWF4X3JlY29yZHMgPSBtaS5nZXRNYXhSZWNvcmRzKCkgPD0gMCA/IDEwMCA6IG1pLmdldE1heFJlY29yZHMoKQ0KICAgICAgICBFeHByZXNzaW9uRmFjdG9yeSBleHByZXNzaW9uID0gZGF0YWJhc2UuZ2V0RXhwcmVzc2lvbkZhY3RvcnkoIk1JVFdITCIpDQoNCiAgICAgICAgaWYobGlzdHJlc3BvbnNlTU1TMDU5X0xpc3RHbG9iYWwuc2l6ZSgpID4gMSAmJiBpbldITE8udHJpbSgpPT0iIiAmJiBpblNQTE0udHJpbSgpIT0iIil7DQogICAgICAgIGRlZiB3aGxvVmFsdWVzID0gbGlzdHJlc3BvbnNlTU1TMDU5X0xpc3RHbG9iYWwqLkZXSEwuY29sbGVjdCB7IGl0Py50cmltKCkgfS5maW5kQWxsIHsgaXQgfQ0KICAgICAgICBkZWYgdW5pcXVlV2hsb1ZhbHVlcyA9IHdobG9WYWx1ZXMudW5pcXVlKCkNCiAgICAgICAgZXhwcmVzc2lvbiA9IGV4cHJlc3Npb24uZXEoIk1XV0hMTyIsIHVuaXF1ZVdobG9WYWx1ZXNbMF0pDQogICAgICAgIGZvciAodmFsdWUgaW4gdW5pcXVlV2hsb1ZhbHVlcykgew0KICAgICAgICAgICAgZXhwcmVzc2lvbiA9IGV4cHJlc3Npb24ub3IoZXhwcmVzc2lvbi5lcSgiTVdXSExPIiwgdmFsdWUudG9TdHJpbmcoKSkpDQogICAgICAgIH0NCg0KDQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZihsaXN0cmVzcG9uc2VNTVMwNTlfTGlzdEdsb2JhbC5zaXplKCk+MSAmJiAoaW5PQUxUPT0wIHx8IGluT0FMVD09MSkgJiYgaW5XSExPLnRyaW0oKT09IiIpew0KICAgICAgICBkZWYgd2hsb1ZhbHVlcyA9IGxpc3RyZXNwb25zZU1NUzA1OV9MaXN0R2xvYmFsKi5GV0hMLmNvbGxlY3QgeyBpdD8udHJpbSgpIH0uZmluZEFsbCB7IGl0IH0udW5pcXVlKCkNCg0KICAgICAgICBkZWYgdW5pcXVlV2hsb1ZhbHVlcyA9IHdobG9WYWx1ZXMudW5pcXVlKCkNCiAgICAgICAgZXhwcmVzc2lvbiA9IGV4cHJlc3Npb24uZXEoIk1XV0hMTyIsIHVuaXF1ZVdobG9WYWx1ZXNbMF0pDQogICAgICAgIGZvciAodmFsdWUgaW4gdW5pcXVlV2hsb1ZhbHVlcykgew0KICAgICAgICAgICAgZXhwcmVzc2lvbiA9IGV4cHJlc3Npb24ub3IoZXhwcmVzc2lvbi5lcSgiTVdXSExPIiwgdmFsdWUudG9TdHJpbmcoKSkpDQogICAgICAgIH0gICAgICAgICAgDQogICAgICAgIH0NCiAgICAgICAgZWxzZXsNCiAgICAgICAgIGV4cHJlc3Npb24gPSBleHByZXNzaW9uLmVxKCJNV1dITE8iLCB3aGxvKQ0KICAgICAgICB9DQogICAgICAgIC8vIHdobG9WYWx1ZXMuZWFjaCB7IHZhbHVlIC0+DQogICAgICAgIC8vICAgZXhwcmVzc2lvbj0gZXhwcmVzc2lvbi5vcihleHByZXNzaW9uLmVxKCJNV1dITE8iLCB2YWx1ZSkpDQogICAgICAgIC8vIH0NCiAgICAgICAgDQogICAgICAgIGV4cHJlc3Npb24gPSBleHByZXNzaW9uLmFuZChleHByZXNzaW9uLmVxKCJNV0NPTk8iLCBwcm9ncmFtLkxEQVpELmdldCgiQ09OTyIpIGFzIFN0cmluZykpDQoNCiAgICAgICAgICAgICAgICBEQkFjdGlvbiBxdWVyeSA9IGRhdGFiYXNlLnRhYmxlKCJNSVRXSEwiKQ0KICAgICAgICAgICAgICAgIC5pbmRleCgiMDAiKQ0KICAgICAgICAgICAgICAgIC5tYXRjaGluZyhleHByZXNzaW9uKQ0KICAgICAgICAgICAgICAgIC5zZWxlY3RBbGxGaWVsZHMoKQ0KICAgICAgICAgICAgICAgIC5idWlsZCgpDQogICAgICAgIERCQ29udGFpbmVyIGNvbnRhaW5lciA9IHF1ZXJ5LmdldENvbnRhaW5lcigpDQogICAgICAgIGRlZiBteUxpc3QgPSBbXQ0KICAgICAgICBxdWVyeS5yZWFkQWxsKGNvbnRhaW5lciwgMCwgbWF4X3JlY29yZHMpIHsgREJDb250YWluZXIgY29udGFpbmVyMSAtPg0KICAgICAgICAgICAgZGVmIG15T2JqZWN0ID0gW01XQ09OTzogY29udGFpbmVyMS5nZXQoIk1XQ09OTyIpLnRvU3RyaW5nKCksIE1XV0hMTzogY29udGFpbmVyMS5nZXQoIk1XV0hMTyIpLnRvU3RyaW5nKCksIE1XU0RFUzogY29udGFpbmVyMS5nZXQoIk1XU0RFUyIpLnRvU3RyaW5nKCksIE1XV0hOTTogY29udGFpbmVyMS5nZXQoIk1XV0hOTSIpLnRvU3RyaW5nKCldDQogICAgICAgICAgICBteUxpc3QuYWRkKG15T2JqZWN0KQ0KICAgICAgICB9DQogICAgICAgIGFycmF5b2ZQbGFjZW9mTG9hZGluZz1teUxpc3QNCiAgICAgICAgcmV0cmlldmVSb3V0ZUZyb21QbGFjZW9mTG9hZGluZygpDQogICAgICAgIA0KICAgIH0NCiAgICANCiAgICANCiAgICANCiAgICANCiAgICANCiAgICANCiAgICANCiAgICAgICAgICAgIHZvaWQgcmV0cmlldmVSb3V0ZUZyb21QbGFjZW9mTG9hZGluZ0FuZEN1c3RvbWVyKCkgew0KICAgICAgICAgICAgaW50IG1heF9yZWNvcmRzID0gbWkuZ2V0TWF4UmVjb3JkcygpIDw9IDAgPyAxMDAwMCA6IG1pLmdldE1heFJlY29yZHMoKQ0KICAgICAgICAgICAgRXhwcmVzc2lvbkZhY3RvcnkgZXhwcmVzc2lvbkZhY3RvcnkgPSBkYXRhYmFzZS5nZXRFeHByZXNzaW9uRmFjdG9yeSgiRFJPRFBSIikNCiAgICAgICAgICAgIGRlZiBwbGFjZU9mTG9hZGluZ1ZhbHVlcyA9IGFycmF5b2ZQbGFjZW9mTG9hZGluZy5jb2xsZWN0IHsgaXQ/Lk1XU0RFUz8udHJpbSgpIH0uZmluZEFsbCB7IGl0IH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYgKHBsYWNlT2ZMb2FkaW5nVmFsdWVzLmlzRW1wdHkoKSkgew0KICAgICAgICAgICAgICAgIHJldHVybg0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZGVmIGV4cHJlc3Npb24gPSBleHByZXNzaW9uRmFjdG9yeS5lcSgiRE9FREVTIiwgcGxhY2VPZkxvYWRpbmdWYWx1ZXNbMF0pLmFuZChleHByZXNzaW9uRmFjdG9yeS5lcSgiRE9PQlYxIiwgaW5DVU5PLnRyaW0oKSkpDQogICAgICAgICAgICBwbGFjZU9mTG9hZGluZ1ZhbHVlcy5kcm9wKDEpLmVhY2ggeyBtd3NkZXMgLT4NCiAgICAgICAgICAgICAgICBleHByZXNzaW9uID0gZXhwcmVzc2lvbi5vcihleHByZXNzaW9uRmFjdG9yeS5lcSgiRE9FREVTIiwgbXdzZGVzKSkuYW5kKGV4cHJlc3Npb25GYWN0b3J5LmVxKCJET09CVjEiLCBpbkNVTk8udHJpbSgpKSkNCiAgICAgICAgICAgIH0NCiAgICAgICAgDQogICAgICAgICAgICBleHByZXNzaW9uID0gZXhwcmVzc2lvbi5hbmQoZXhwcmVzc2lvbkZhY3RvcnkuZXEoIkRPQ09OTyIsIHByb2dyYW0uTERBWkQuZ2V0KCJDT05PIikgYXMgU3RyaW5nKSkNCiAgICAgICAgDQogICAgICAgICAgICAvLyBCdWlsZCBhbmQgZXhlY3V0ZSB0aGUgcXVlcnkNCiAgICAgICAgICAgIERCQWN0aW9uIHF1ZXJ5ID0gZGF0YWJhc2UudGFibGUoIkRST0RQUiIpDQogICAgICAgICAgICAgICAgLmluZGV4KCIwMCIpDQogICAgICAgICAgICAgICAgLm1hdGNoaW5nKGV4cHJlc3Npb24pDQogICAgICAgICAgICAgICAgLnNlbGVjdEFsbEZpZWxkcygpDQogICAgICAgICAgICAgICAgLmJ1aWxkKCkNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgREJDb250YWluZXIgY29udGFpbmVyID0gcXVlcnkuZ2V0Q29udGFpbmVyKCkNCiAgICAgICAgICAgIGRlZiBteUxpc3QgPSBbXQ0KICAgICAgICANCiAgICAgICAgICAgIC8vIFJlYWQgYWxsIHJlY29yZHMNCiAgICAgICAgICAgIHF1ZXJ5LnJlYWRBbGwoY29udGFpbmVyLCAwLCBtYXhfcmVjb3JkcykgeyBEQkNvbnRhaW5lciBjb250YWluZXIxIC0+DQogICAgICAgICAgICAgICAgZGVmIG15T2JqZWN0ID0gWw0KICAgICAgICAgICAgICAgICAgICBET0NPTk86IGNvbnRhaW5lcjEuZ2V0KCJET0NPTk8iKT8udG9TdHJpbmcoKSwNCiAgICAgICAgICAgICAgICAgICAgRE9FREVTOiBjb250YWluZXIxLmdldCgiRE9FREVTIik/LnRvU3RyaW5nKCksDQogICAgICAgICAgICAgICAgICAgIERPUk9VVDogY29udGFpbmVyMS5nZXQoIkRPUk9VVCIpPy50b1N0cmluZygpLA0KICAgICAgICAgICAgICAgICAgICAvL0RSVFg0MDogY29udGFpbmVyMS5nZXQoIkRSVFg0MCIpPy50b1N0cmluZygpDQogICAgICAgICAgICAgICAgXQ0KICAgICAgICAgICAgICAgIG15TGlzdC5hZGQobXlPYmplY3QpDQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIGFycmF5T0ZSb3V0ZXNBbGxvd2ZvckN1bm89bXlMaXN0DQoNCiAgICAgICAgLy8gYXJyYXlPRlJvdXRlcz1teUxpc3QNCiAgICAgICAgLy8gcmV0cmlldmVJdGVtUXR5QXRXYXJlaG91c2UoKQ0KICAgICAgICAvLyByZXRyaWV2ZUR1cmF0aW9uRnJvbVJvdXRlKCkNCiAgICAgICAgfQ0KICAgIA0KICAgIA0KICAgIA0KICAgIA0KICAgIA0KICAgIA0KICAgIA0KICAgIA0KICAgIA0KICAgIA0KICAgIA0KICAgIA0KICAgIA0KICAgIA0KICAgIA0KICAgIA0KICAgIA0KICAgIA0KICAgIA0KICAgIA0KICAgIA0KICAgIA0KICAgICAgICB2b2lkIHJldHJpZXZlUm91dGVGcm9tUGxhY2VvZkxvYWRpbmcoKSB7DQogICAgICAgICAgcmV0cmlldmVSb3V0ZUZyb21QbGFjZW9mTG9hZGluZ0FuZEN1c3RvbWVyKCkNCiAgICAgICAgICAgIGludCBtYXhfcmVjb3JkcyA9IG1pLmdldE1heFJlY29yZHMoKSA8PSAwID8gMTAwMDAgOiBtaS5nZXRNYXhSZWNvcmRzKCkNCiAgICAgICAgICAgIEV4cHJlc3Npb25GYWN0b3J5IGV4cHJlc3Npb25GYWN0b3J5ID0gZGF0YWJhc2UuZ2V0RXhwcmVzc2lvbkZhY3RvcnkoIkRST1VURSIpDQogICAgICAgICAgICAvL2RlZiBwbGFjZU9mTG9hZGluZ1ZhbHVlcyA9IGFycmF5b2ZQbGFjZW9mTG9hZGluZy5jb2xsZWN0IHsgaXQ/Lk1XU0RFUz8udHJpbSgpIH0uZmluZEFsbCB7IGl0IH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYgKGFycmF5T0ZSb3V0ZXNBbGxvd2ZvckN1bm8uaXNFbXB0eSgpKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuDQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAvLyBTdGFydCB3aXRoIHRoZSBmaXJzdCBlbGVtZW50J3MgY29uZGl0aW9ucw0KICAgICAgICAgIGRlZiBleHByZXNzaW9uID0gZXhwcmVzc2lvbkZhY3RvcnkuZXEoIkRSU0RFUyIsIGFycmF5T0ZSb3V0ZXNBbGxvd2ZvckN1bm9bMF1bJ0RPRURFUyddKQ0KICAgICAgICAgIGV4cHJlc3Npb24gPSBleHByZXNzaW9uLmFuZChleHByZXNzaW9uRmFjdG9yeS5lcSgiRFJST1VUIiwgYXJyYXlPRlJvdXRlc0FsbG93Zm9yQ3Vub1swXVsnRE9ST1VUJ10pKQ0KICAgICAgICAgIA0KICAgICAgICAgIC8vIExvb3AgdGhyb3VnaCB0aGUgcmVtYWluaW5nIGVsZW1lbnRzDQogICAgICAgICAgYXJyYXlPRlJvdXRlc0FsbG93Zm9yQ3Vuby5kcm9wKDEpLmVhY2ggeyBlbGVtZW50IC0+DQogICAgICAgICAgICAgIGRlZiB0ZW1wRXhwcmVzc2lvbiA9IGV4cHJlc3Npb25GYWN0b3J5LmVxKCJEUlNERVMiLCBlbGVtZW50LkRPRURFUykNCiAgICAgICAgICAgICAgdGVtcEV4cHJlc3Npb24gPSB0ZW1wRXhwcmVzc2lvbi5hbmQoZXhwcmVzc2lvbkZhY3RvcnkuZXEoIkRSUk9VVCIsIGVsZW1lbnQuRE9ST1VUKSkNCiAgICAgICAgICAgICAgDQogICAgICAgICAgICAgIC8vIENvbWJpbmUgdGhlIGN1cnJlbnQgZXhwcmVzc2lvbiB3aXRoIHRoZSBuZXcgb25lIHVzaW5nIE9SDQogICAgICAgICAgICAgIGV4cHJlc3Npb24gPSBleHByZXNzaW9uLm9yKHRlbXBFeHByZXNzaW9uKQ0KICAgICAgICAgIH0NCiAgICAgICAgICANCiAgICAgICAgICAvLyBGaW5hbGx5LCBhZGQgdGhlIERSQ09OTyBjb25kaXRpb24NCiAgICAgICAgICBleHByZXNzaW9uID0gZXhwcmVzc2lvbi5hbmQoZXhwcmVzc2lvbkZhY3RvcnkuZXEoIkRSQ09OTyIsIHByb2dyYW0uTERBWkQuZ2V0KCJDT05PIikgYXMgU3RyaW5nKSkNCg0KICAgICAgICAgICAgLy8gQnVpbGQgYW5kIGV4ZWN1dGUgdGhlIHF1ZXJ5DQogICAgICAgICAgICBEQkFjdGlvbiBxdWVyeSA9IGRhdGFiYXNlLnRhYmxlKCJEUk9VVEUiKQ0KICAgICAgICAgICAgICAgIC5pbmRleCgiMDAiKQ0KICAgICAgICAgICAgICAgIC5tYXRjaGluZyhleHByZXNzaW9uKQ0KICAgICAgICAgICAgICAgIC5zZWxlY3RBbGxGaWVsZHMoKQ0KICAgICAgICAgICAgICAgIC5idWlsZCgpDQogICAgICAgICAgICANCiAgICAgICAgICAgIERCQ29udGFpbmVyIGNvbnRhaW5lciA9IHF1ZXJ5LmdldENvbnRhaW5lcigpDQogICAgICAgICAgICBkZWYgbXlMaXN0ID0gW10NCiAgICAgICAgDQogICAgICAgICAgICAvLyBSZWFkIGFsbCByZWNvcmRzDQogICAgICAgICAgICBxdWVyeS5yZWFkQWxsKGNvbnRhaW5lciwgMCwgbWF4X3JlY29yZHMpIHsgREJDb250YWluZXIgY29udGFpbmVyMSAtPg0KICAgICAgICAgICAgICAgIGRlZiBteU9iamVjdCA9IFsNCiAgICAgICAgICAgICAgICAgICAgRFJDT05POiBjb250YWluZXIxLmdldCgiRFJDT05PIik/LnRvU3RyaW5nKCksDQogICAgICAgICAgICAgICAgICAgIERSU0RFUzogY29udGFpbmVyMS5nZXQoIkRSU0RFUyIpPy50b1N0cmluZygpLA0KICAgICAgICAgICAgICAgICAgICBEUlJPVVQ6IGNvbnRhaW5lcjEuZ2V0KCJEUlJPVVQiKT8udG9TdHJpbmcoKSwNCiAgICAgICAgICAgICAgICAgICAgRFJUWDQwOiBjb250YWluZXIxLmdldCgiRFJUWDQwIik/LnRvU3RyaW5nKCkNCiAgICAgICAgICAgICAgICBdDQogICAgICAgICAgICAgICAgbXlMaXN0LmFkZChteU9iamVjdCkNCiAgICAgICAgICAgIH0NCg0KICAgICAgICBhcnJheU9GUm91dGVzPW15TGlzdA0KICAgICAgICByZXRyaWV2ZUl0ZW1RdHlBdFdhcmVob3VzZSgpDQogICAgICAgIHJldHJpZXZlRHVyYXRpb25Gcm9tUm91dGUoKQ0KICAgICAgICB9DQogICAgICAgIA0KICAgIHZvaWQgcmV0cmlldmVJdGVtUXR5QXRXYXJlaG91c2UoKSB7DQogICAgICAgIGludCBtYXhfcmVjb3JkcyA9IG1pLmdldE1heFJlY29yZHMoKSA8PSAwID8gMTAwIDogbWkuZ2V0TWF4UmVjb3JkcygpDQogICAgICAgIEV4cHJlc3Npb25GYWN0b3J5IGV4cHJlc3Npb24gPSBkYXRhYmFzZS5nZXRFeHByZXNzaW9uRmFjdG9yeSgiTUlUQkFMIikNCiAgICAgICAgZGVmIHdobG9WYWx1ZXMgPSBsaXN0cmVzcG9uc2VNTVMwNTlfTGlzdEdsb2JhbCouRldITC5jb2xsZWN0IHsgaXQ/LnRyaW0oKSB9LmZpbmRBbGwgeyBpdCB9DQogICAgICAgIGRlZiB1bmlxdWVXaGxvVmFsdWVzID0gd2hsb1ZhbHVlcy51bmlxdWUoKQ0KICAgICAgICANCiAgICAgICAgZXhwcmVzc2lvbiA9IGV4cHJlc3Npb24uZXEoIk1CV0hMTyIsIHVuaXF1ZVdobG9WYWx1ZXNbMF0pDQogICAgICAgIGZvciAodmFsdWUgaW4gdW5pcXVlV2hsb1ZhbHVlcykgew0KICAgICAgICAgICAgZXhwcmVzc2lvbiA9IGV4cHJlc3Npb24ub3IoZXhwcmVzc2lvbi5lcSgiTUJXSExPIiwgdmFsdWUudG9TdHJpbmcoKSkpDQogICAgICAgIH0NCiAgICANCiAgICAgICAgZXhwcmVzc2lvbiA9IGV4cHJlc3Npb24uYW5kKGV4cHJlc3Npb24uZXEoIk1CQ09OTyIsIHByb2dyYW0uTERBWkQuZ2V0KCJDT05PIikgYXMgU3RyaW5nKSkNCiAgICAgICAgaWYoaW5JVE5PIT0iIil7DQogICAgICAgIGV4cHJlc3Npb24gPSBleHByZXNzaW9uLmFuZChleHByZXNzaW9uLmVxKCJNQklUTk8iLGluSVROTyApKQ0KICAgICAgICB9DQogICAgICAgIGVsc2V7DQogICAgICAgIGV4cHJlc3Npb24gPSBleHByZXNzaW9uLmFuZChleHByZXNzaW9uLmVxKCJNQklUTk8iLElUTk9wb3A1b3I0ICkpDQogICAgICAgIH0NCiAgICANCiAgICAgICAgREJBY3Rpb24gcXVlcnkgPSBkYXRhYmFzZS50YWJsZSgiTUlUQkFMIikNCiAgICAgICAgICAgIC5pbmRleCgiMDAiKQ0KICAgICAgICAgICAgLm1hdGNoaW5nKGV4cHJlc3Npb24pDQogICAgICAgICAgICAuc2VsZWN0QWxsRmllbGRzKCkNCiAgICAgICAgICAgIC5idWlsZCgpDQogICAgICAgIA0KICAgICAgICBEQkNvbnRhaW5lciBjb250YWluZXIgPSBxdWVyeS5nZXRDb250YWluZXIoKQ0KICAgICAgICBkZWYgbXlMaXN0ID0gW10NCiAgICANCiAgICAgICAgLy8gUmVhZCBhbGwgcmVjb3Jkcw0KICAgICAgICBxdWVyeS5yZWFkQWxsKGNvbnRhaW5lciwgMCwgbWF4X3JlY29yZHMpIHsgREJDb250YWluZXIgY29udGFpbmVyMSAtPg0KICAgICAgICAgICAgZGVmIG15T2JqZWN0ID0gWw0KICAgICAgICAgICAgICAgIE1CQ09OTzogY29udGFpbmVyMS5nZXQoIk1CQ09OTyIpPy50b1N0cmluZygpLA0KICAgICAgICAgICAgICAgIE1CV0hMTzogY29udGFpbmVyMS5nZXQoIk1CV0hMTyIpPy50b1N0cmluZygpLA0KICAgICAgICAgICAgICAgIE1CVE9NVTogY29udGFpbmVyMS5nZXQoIk1CVE9NVSIpPy50b1N0cmluZygpLA0KICAgICAgICAgICAgICAgIE1CQUxRVDogY29udGFpbmVyMS5nZXQoIk1CQUxRVCIpPy50b1N0cmluZygpLA0KICAgICAgICAgICAgICAgIE1CQVZBTDogY29udGFpbmVyMS5nZXQoIk1CQVZBTCIpPy50b1N0cmluZygpDQogICAgICAgICAgICBdDQogICAgICAgICAgICBteUxpc3QuYWRkKG15T2JqZWN0KQ0KICAgICAgICAgICAgYXJyYXlPRldhcmVob3VzZVFUWT1teUxpc3QNCiAgICAgICAgfQ0KICAgIH0gICANCg0KICAgIHZvaWQgcmV0cmlldmVEdXJhdGlvbkZyb21Sb3V0ZSgpIHsNCiAgICAgICAgaW50IG1heF9yZWNvcmRzID0gbWkuZ2V0TWF4UmVjb3JkcygpIDw9IDAgPyAxMDAwMCA6IG1pLmdldE1heFJlY29yZHMoKQ0KICAgICAgICBFeHByZXNzaW9uRmFjdG9yeSBleHByZXNzaW9uRmFjdG9yeSA9IGRhdGFiYXNlLmdldEV4cHJlc3Npb25GYWN0b3J5KCJEUk9VREkiKQ0KICAgIA0KICAgICAgICBkZWYgYXJyYXlPRlJvdXRlc1ZhbHVlcyA9IGFycmF5T0ZSb3V0ZXMuY29sbGVjdCB7IGl0Py5EUlJPVVQ/LnRyaW0oKSB9LmZpbmRBbGwgeyBpdCB9DQogICAgICAgIA0KICAgICAgICBpZiAoYXJyYXlPRlJvdXRlc1ZhbHVlcy5pc0VtcHR5KCkpIHsNCiAgICAgICAgICAgIHJldHVybg0KICAgICAgICB9DQogICAgDQogICAgICAgIGRlZiBleHByZXNzaW9uID0gZXhwcmVzc2lvbkZhY3RvcnkuZXEoIkRTUk9VVCIsIGFycmF5T0ZSb3V0ZXNWYWx1ZXNbMF0pDQogICAgDQogICAgICAgIGFycmF5T0ZSb3V0ZXNWYWx1ZXMuZHJvcCgxKS5lYWNoIHsgZHJyb3V0IC0+DQogICAgICAgICAgICBleHByZXNzaW9uID0gZXhwcmVzc2lvbi5vcihleHByZXNzaW9uRmFjdG9yeS5lcSgiRFNST1VUIiwgZHJyb3V0KSkNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICBleHByZXNzaW9uID0gZXhwcmVzc2lvbi5hbmQoZXhwcmVzc2lvbkZhY3RvcnkuZXEoIkRTQ09OTyIsIHByb2dyYW0uTERBWkQuZ2V0KCJDT05PIikgYXMgU3RyaW5nKSkNCiAgICANCiAgICAgICAgREJBY3Rpb24gcXVlcnkgPSBkYXRhYmFzZS50YWJsZSgiRFJPVURJIikNCiAgICAgICAgICAgIC5pbmRleCgiMDAiKQ0KICAgICAgICAgICAgLm1hdGNoaW5nKGV4cHJlc3Npb24pDQogICAgICAgICAgICAuc2VsZWN0QWxsRmllbGRzKCkNCiAgICAgICAgICAgIC5idWlsZCgpDQogICAgICAgIA0KICAgICAgICBEQkNvbnRhaW5lciBjb250YWluZXIgPSBxdWVyeS5nZXRDb250YWluZXIoKQ0KICAgICAgICBkZWYgbXlMaXN0ID0gW10NCiAgICANCiAgICAgICAgLy8gUmVhZCBhbGwgcmVjb3Jkcw0KICAgICAgICBxdWVyeS5yZWFkQWxsKGNvbnRhaW5lciwgMCwgbWF4X3JlY29yZHMpIHsgREJDb250YWluZXIgY29udGFpbmVyMSAtPg0KICAgICAgICAgICAgZGVmIG15T2JqZWN0ID0gWw0KICAgICAgICAgICAgICAgIERTQ09OTzogY29udGFpbmVyMS5nZXQoIkRTQ09OTyIpPy50b1N0cmluZygpLA0KICAgICAgICAgICAgICAgIERTUk9VVDogY29udGFpbmVyMS5nZXQoIkRTUk9VVCIpPy50b1N0cmluZygpLA0KICAgICAgICAgICAgICAgIERTRERPVzogY29udGFpbmVyMS5nZXQoIkRTRERPVyIpPy50b1N0cmluZygpLA0KICAgICAgICAgICAgICAgIERTQVJISDogY29udGFpbmVyMS5nZXQoIkRTQVJISCIpPy50b1N0cmluZygpPy5wYWRMZWZ0KDIsICcwJyksDQogICAgICAgICAgICAgICAgRFNBUk1NOiBjb250YWluZXIxLmdldCgiRFNBUk1NIik/LnRvU3RyaW5nKCk/LnBhZExlZnQoMiwgJzAnKSwNCiAgICAgICAgICAgICAgICBEU0xJTEg6IGNvbnRhaW5lcjEuZ2V0KCJEU0xJTEgiKT8udG9TdHJpbmcoKT8ucGFkTGVmdCgyLCAnMCcpLA0KICAgICAgICAgICAgICAgIERTTElMTTogY29udGFpbmVyMS5nZXQoIkRTTElMTSIpPy50b1N0cmluZygpPy5wYWRMZWZ0KDIsICcwJyksDQogICAgICAgICAgICAgICAvLyBEU0RFVEg6IGNvbnRhaW5lcjEuZ2V0KCJEU0RFVEgiKT8udG9TdHJpbmcoKT8ucGFkTGVmdCgyLCAnMCcpLA0KICAgICAgICAgICAgICAgLy9EU0RFVE06IGNvbnRhaW5lcjEuZ2V0KCJEU0RFVE0iKT8udG9TdHJpbmcoKT8ucGFkTGVmdCgyLCAnMCcpLA0KICAgICAgICAgICAgICAgIERTQVJEWTogY29udGFpbmVyMS5nZXQoIkRTQVJEWSIpPy50b1N0cmluZygpLA0KICAgICAgICAgICAgICAgIERTUk9ETjogY29udGFpbmVyMS5nZXQoIkRTUk9ETiIpPy50b1N0cmluZygpDQogICAgICAgICAgICBdDQogICAgICAgICAgICBteUxpc3QuYWRkKG15T2JqZWN0KQ0KICAgICAgICAgICAgYXJyYXlPRkR1cmF0aW9uPW15TGlzdA0KICAgICAgICB9DQogICAgICAgIA0KICAgIGpvaW5BcnJheXMoKQ0KICAgIH0gICANCiAgICANCiAgICB2b2lkIGpvaW5BcnJheXMoKXsNCiAgICAvLyBTdGVwIDA6IEpvaW4gYXJyYXkwIGFuZCBhcnJheTENCiAgICBkZWYgam9pbmVkQXJyYXkwQW5kMSA9YXJyYXlPRldhcmVob3VzZVFUWS5jb2xsZWN0TWFueSB7IG1iSXRlbSAtPg0KICAgICAgICBhcnJheW9mUGxhY2VvZkxvYWRpbmcuZmluZEFsbCB7IG13SXRlbSAtPg0KICAgICAgICAgICAgbXdJdGVtLk1XQ09OTyA9PSBtYkl0ZW0uTUJDT05PICYmICBtd0l0ZW0uTVdXSExPID09IG1iSXRlbS5NQldITE8NCiAgICAgICAgfS5jb2xsZWN0IHsgbXdJdGVtIC0+DQogICAgICAgICAgICBbTVdDT05POiBtd0l0ZW0uTVdDT05PLCBNV1dITE86IG13SXRlbS5NV1dITE8sIE1XU0RFUzogbXdJdGVtLk1XU0RFUywgTVdXSE5NOiBtd0l0ZW0uTVdXSE5NLCBNQkFWQUw6bWJJdGVtLk1CQVZBTCwgTUJBTFFUOm1iSXRlbS5NQkFMUVQsTUJUT01VOm1iSXRlbS5NQlRPTVUgXQ0KICAgICAgICB9DQogICAgfSANCiAgICAvLyBTdGVwIDE6IEpvaW4gYXJyYXkxIGFuZCBhcnJheTINCiAgICBkZWYgam9pbmVkQXJyYXkxQW5kMiA9IGpvaW5lZEFycmF5MEFuZDEuY29sbGVjdE1hbnkgeyBtd0l0ZW0gLT4NCiAgICAgICAgYXJyYXlPRlJvdXRlcy5maW5kQWxsIHsgZHJJdGVtIC0+DQogICAgICAgICAgICBkckl0ZW0uRFJDT05PID09IG13SXRlbS5NV0NPTk8gJiYgZHJJdGVtLkRSU0RFUyA9PSBtd0l0ZW0uTVdTREVTDQogICAgICAgIH0uY29sbGVjdCB7IGRySXRlbSAtPg0KICAgICAgICAgICAgW01XQ09OTzogbXdJdGVtLk1XQ09OTywgTVdXSExPOiBtd0l0ZW0uTVdXSExPLCBNV1NERVM6IG13SXRlbS5NV1NERVMsIE1XV0hOTTogbXdJdGVtLk1XV0hOTSwNCiAgICAgICAgICAgICBEUlJPVVQ6IGRySXRlbS5EUlJPVVQsIERSVFg0MDogZHJJdGVtLkRSVFg0MCwgTUJBVkFMOiBtd0l0ZW0uTUJBVkFMLCBNQkFMUVQ6IG13SXRlbS5NQkFMUVQsTUJUT01VOiBtd0l0ZW0uTUJUT01VIF0NCiAgICAgICAgfQ0KICAgIH0NCiAgICANCiAgICAvLyBTdGVwIDI6IEpvaW4gdGhlIHJlc3VsdCB3aXRoIGFycmF5Mw0KICAgIGRlZiBmaW5hbEpvaW5lZEFycmF5ID0gam9pbmVkQXJyYXkxQW5kMi5jb2xsZWN0TWFueSB7IGl0ZW0xIC0+DQogICAgICAgIGFycmF5T0ZEdXJhdGlvbi5maW5kQWxsIHsgZHNJdGVtIC0+DQogICAgICAgICAgICBkc0l0ZW0uRFNDT05PID09IGl0ZW0xLk1XQ09OTyAmJiBkc0l0ZW0uRFNST1VUID09IGl0ZW0xLkRSUk9VVA0KICAgICAgICB9LmNvbGxlY3QgeyBkc0l0ZW0gLT4NCiAgICAgICAgICAgIFtNV0NPTk86IGl0ZW0xLk1XQ09OTywgTVdXSExPOiBpdGVtMS5NV1dITE8sIE1XU0RFUzogaXRlbTEuTVdTREVTLCBNV1dITk06IGl0ZW0xLk1XV0hOTSwNCiAgICAgICAgICAgICBEUlJPVVQ6IGl0ZW0xLkRSUk9VVCwgRFJUWDQwOiBpdGVtMS5EUlRYNDAsIERTRERPVzogZHNJdGVtLkRTRERPVywgRFNBUkhIOiBkc0l0ZW0uRFNBUkhILCBEU0FSTU06IGRzSXRlbS5EU0FSTU0sIE1CQVZBTDogaXRlbTEuTUJBVkFMLCBNQkFMUVQ6IGl0ZW0xLk1CQUxRVCwgTUJUT01VOiBpdGVtMS5NQlRPTVUsIERTTElMSDogZHNJdGVtLkRTTElMSCwgRFNMSUxNOiBkc0l0ZW0uRFNMSUxNLCBEU0FSRFk6IGRzSXRlbS5EU0FSRFksIERTUk9ETjogZHNJdGVtLkRTUk9ETl0NCiAgICAgICAgfQ0KICAgIH0gIA0KDQogICAgICBmaW5hbEJpZ0FycmF5PWZpbmFsSm9pbmVkQXJyYXkNCg0KICAgIHVwZGF0ZWRBcnJheSA9IGZpbmFsQmlnQXJyYXkuZWFjaCB7IGl0ZW0gLT4NCiAgICAgIGRlZiB2YXIxPSBnZXROZXh0QWN0aXZlRGF0ZVRpbWUoaXRlbVsiRFNERE9XIl0udG9TdHJpbmcoKSwgZGF0ZVRpbWVab25lLCB0aW1lVGltZVpvbmUsIGl0ZW1bIkRTTElMSCJdIGFzIEludGVnZXIsIGl0ZW1bIkRTTElMTSJdIGFzIEludGVnZXIpDQogICAgICBkZWYgZGF0ZVlZWVlNTUREPUxvY2FsRGF0ZVRpbWUucGFyc2UodmFyMS50b1N0cmluZygpLCBEYXRlVGltZUZvcm1hdHRlci5vZlBhdHRlcm4oJ3l5eXktTU0tZGRcJ1RcJ0hIOm1tJykpLmZvcm1hdChEYXRlVGltZUZvcm1hdHRlci5vZlBhdHRlcm4oJ3l5eXlNTWRkJykpDQogICAgICBkZWYgbmV3RGF0ZVN0cmluZyA9IExvY2FsRGF0ZS5wYXJzZShkYXRlWVlZWU1NREQgYXMgU3RyaW5nLCBEYXRlVGltZUZvcm1hdHRlci5vZlBhdHRlcm4oJ3l5eXlNTWRkJykpLnBsdXNEYXlzKGl0ZW1bIkRTQVJEWSJdIGFzIEludGVnZXIpLmZvcm1hdChEYXRlVGltZUZvcm1hdHRlci5vZlBhdHRlcm4oJ3l5eXlNTWRkJykpDQogICAgICBpdGVtWyJEU0RUIl0gID0gZGF0ZVlZWVlNTUREDQogICAgICBpdGVtWyJEU0RET1ciXSA9bmV3RGF0ZVN0cmluZyAvL2FkZGVkIGFyZHkgd2l0aCBkZXBhcnR1cmUgZGF0ZQ0KICAgICAgICByZXR1cm4gaXRlbQ0KICAgIH0NCg0KICAgIHNvcnRBcnJheUJ5RGF0ZVRpbWUoKQ0KICAgIH0NCg0Kdm9pZCBzb3J0QXJyYXlCeURhdGVUaW1lKCkgew0KICAgIGRlZiBzb3J0ZWREYXRhID0gdXBkYXRlZEFycmF5LmNvbGxlY3QoKS5zb3J0IHsgYSwgYiAtPg0KICAgICAgICBhWyJEU0RET1ciXSBhcyBJbnRlZ2VyIDw9PiBiWyJEU0RET1ciXSBhcyBJbnRlZ2VyID86DQogICAgICAgIGFbIkRTQVJISCJdIGFzIEludGVnZXIgPD0+IGJbIkRTQVJISCJdIGFzIEludGVnZXIgPzoNCiAgICAgICAgYVsiRFNBUk1NIl0gYXMgSW50ZWdlciA8PT4gYlsiRFNBUk1NIl0gYXMgSW50ZWdlcg0KICAgIH0NCg0KICAgIC8vIEtlZXAgb25seSB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZiBlYWNoIERSUk9VVA0KICAgIHVuaXF1ZURhdGE9c29ydGVkRGF0YS8vIHRvIGNvbW1lbnQgbGF0ZXINCiAgICAvL3VuaXF1ZURhdGEgPSBzb3J0ZWREYXRhLnVuaXF1ZSB7IGl0WyJEUlJPVVQiXSB9DQoNCiAgICAvLy9taS5vdXREYXRhLnB1dCgiVEVTVCIsIHVuaXF1ZURhdGEudG9TdHJpbmcoKSkNCn0NCg0KDQogICAgDQogICAgDQpkZWYgZ2V0TmV4dEFjdGl2ZURhdGVUaW1lKFN0cmluZyBzZXF1ZW5jZSwgU3RyaW5nIGN1cnJlbnREYXRlLCBTdHJpbmcgY3VycmVudFRpbWUsIEludGVnZXIgYXJoaCwgSW50ZWdlciBhcm1tKSB7DQogICAgLy8gRW5zdXJlIHRoZSBzZXF1ZW5jZSBpcyA3IGNoYXJhY3RlcnMgbG9uZyAoTW9uZGF5IHRvIFN1bmRheSkNCiAgICBpZiAoc2VxdWVuY2UubGVuZ3RoKCkgIT0gNykgew0KICAgICAgICBtaS5lcnJvcignVGhlIHNlcXVlbmNlIG11c3QgYmUgNyBjaGFyYWN0ZXJzIGxvbmcuJykNCiAgICB9DQoNCg0KICAgIC8vIFZhbGlkYXRlIGRhdGUgYW5kIHRpbWUgZm9ybWF0cw0KICAgIGlmIChjdXJyZW50RGF0ZS5sZW5ndGgoKSAhPSA4IHx8IGN1cnJlbnRUaW1lLmxlbmd0aCgpICE9IDQpIHsNCiAgICAgICAgbWkuZXJyb3IoJ1RoZSBkYXRlIHNob3VsZCBiZSBpbiBZWVlZTU1ERCBmb3JtYXQgYW5kIHRpbWUgaW4gSEhNTSBmb3JtYXQuJykNCiAgICB9DQogICAgDQoNCg0KDQogICAgZGVmIGZvcm1hdHRlciA9IERhdGVUaW1lRm9ybWF0dGVyLm9mUGF0dGVybigneXl5eU1NZGRISG1tJykNCiAgICBMb2NhbERhdGVUaW1lIHRvZGF5DQoNCiAgICB0cnkgew0KICAgICAgICB0b2RheSA9IExvY2FsRGF0ZVRpbWUucGFyc2UoIiR7Y3VycmVudERhdGV9JHtjdXJyZW50VGltZX0iLCBmb3JtYXR0ZXIpDQogICAgICAgIC8vIHRvZGF5PUxvY2FsRGF0ZVRpbWUucGFyc2UoIiR7Y3VycmVudERhdGV9JHtjdXJyZW50VGltZX0iLCBmb3JtYXR0ZXIpDQogICAgfSBjYXRjaCAoRGF0ZVRpbWVQYXJzZUV4Y2VwdGlvbiBlKSB7DQogICAgICAgIG1pLmVycm9yKGUudG9TdHJpbmcoKSkNCiAgICB9DQoNCiAgICBkZWYgY3VycmVudERheSA9IHRvZGF5LmRheU9mV2Vlay52YWx1ZSAlIDcgLy8gTW9uZGF5IC0gMCwgLi4uLCBTdW5kYXkgLSA2DQogICAgZGVmIHNlcXVlbmNlQXJyYXkgPSBzZXF1ZW5jZS5jb2xsZWN0IHsgaXQgYXMgaW50IH0NCg0KICAgIC8vIElmIHRvZGF5IGlzIFN1bmRheSAoMCksIGFkanVzdCB0byBhbGlnbiB3aXRoIE1vbmRheSBhcyBzdGFydCBvZiB0aGUgd2Vlaw0KICAgIGRlZiBhZGp1c3RlZERheSA9IGN1cnJlbnREYXkgPT0gMCA/IDYgOiBjdXJyZW50RGF5IC0gMQ0KDQoNCiAgICAvLyBDaGVjayBpZiB0aGUgY3VycmVudCBkYXkgaXMgYWN0aXZlIGFuZCBpZiB0aGUgY3VycmVudCB0aW1lIGlzIGJlZm9yZSB0aGUgdGFyZ2V0IHRpbWUNCiAgICBpZiAoc2VxdWVuY2VBcnJheVthZGp1c3RlZERheV0gPT0gMSkgew0KDQogICAgICAgIC8vIEV4YW1wbGUgdGFyZ2V0IHRpbWUgKHlvdSBuZWVkIHRvIGdldCB0aGlzIGZyb20geW91ciBkYXRhKQ0KICAgICAgICBkZWYgdGFyZ2V0SG91cnMgPSBhcmhoDQogICAgICAgIGRlZiB0YXJnZXRNaW51dGVzID0gYXJtbQ0KICAgICAgICBkZWYgdGFyZ2V0RGF0ZVRpbWUgPSBjcmVhdGVEYXRlV2l0aFRpbWUodG9kYXksIHRhcmdldEhvdXJzLCB0YXJnZXRNaW51dGVzKQ0KICAgICAgICAvL21pLm91dERhdGEucHV0KCJURVNUIiwgInRhcmdldCBkYXRlOiIrdGFyZ2V0RGF0ZVRpbWUudG9TdHJpbmcoKSsiIHRvZGF5OiIrdG9kYXkudG9TdHJpbmcoKSkNCiAgICAgICAgaWYgKCEodGFyZ2V0RGF0ZVRpbWUgYXMgTG9jYWxEYXRlVGltZSkuaXNCZWZvcmUodG9kYXkpKSB7DQogICAgICAgICAgICByZXR1cm4gdGFyZ2V0RGF0ZVRpbWUNCiAgICAgICAgfQ0KDQoNCiAgICB9DQoNCiAgICAvLyBGaW5kIHRoZSBuZXh0IGFjdGl2ZSBkYXkNCiAgICBmb3IgKGkgaW4gMS4uNikgew0KICAgICAgICBkZWYgbmV4dERheSA9IChhZGp1c3RlZERheSArIGkpICUgNw0KICAgICAgICBpZiAoc2VxdWVuY2VBcnJheVtuZXh0RGF5XSA9PSAxICkgew0KICAgICAgICAgICAgZGVmIG5leHREYXRlID0gdG9kYXkucGx1c0RheXMoaSkNCiAgICAgICAgICAgIC8vIEV4YW1wbGUgdGFyZ2V0IHRpbWUgKHlvdSBuZWVkIHRvIGdldCB0aGlzIGZyb20geW91ciBkYXRhKQ0KICAgICAgICAgICAgZGVmIHRhcmdldEhvdXJzID0gYXJoaA0KICAgICAgICAgICAgZGVmIHRhcmdldE1pbnV0ZXMgPSBhcm1tDQogICAgICAgICAgICBkZWYgdGFyZ2V0RGF0ZVRpbWUgPSBjcmVhdGVEYXRlV2l0aFRpbWUobmV4dERhdGUsIHRhcmdldEhvdXJzLCB0YXJnZXRNaW51dGVzKQ0KICAgICAgICAgICAgLy8gbWkuZXJyb3IodGFyZ2V0RGF0ZVRpbWUudG9TdHJpbmcoKSkNCiAgICAgICAgICAgIHJldHVybiB0YXJnZXREYXRlVGltZQ0KICAgICAgICAgICAgDQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvLyBJZiBubyB2YWxpZCBkYXRlIGFuZCB0aW1lIGlzIGZvdW5kDQogICAgcmV0dXJuIG51bGwNCn0NCg0KICAgIGRlZiBjcmVhdGVEYXRlV2l0aFRpbWUoTG9jYWxEYXRlVGltZSBkYXRlLCBpbnQgaG91cnMsIGludCBtaW51dGVzKSB7DQogICAgICAgIHJldHVybiBkYXRlLndpdGhIb3VyKGhvdXJzKS53aXRoTWludXRlKG1pbnV0ZXMpLndpdGhTZWNvbmQoMCkNCiAgICAgICAgLy8gcmV0dXJuICIyMDI0MTEwMSIudG9TdHJpbmcoKQ0KICAgIH0NCg0KICAgIHZvaWQgaWZXSExPaXNub3RFbXB0eShTdHJpbmcgd2hsbyl7DQogICAgLy8gaWYoaW5PQUxUIT0xICYmIGluT0FMVCE9MCl7DQogICAgLy8gaWYgKCFNTVMyMDBfR2V0U3VtV2hzQmFsQXBpQ2FsbCh3aGxvLCBJVE5PcG9wNW9yNCkpIHJldHVybg0KICAgIC8vIH0NCiAgICBpZihpblNQTE0hPSIiKXsNCiAgICAgIE1NUzA1OV9MaXN0QXBpQ2FsbChpblNQTE0pDQogICAgICBQQURMNjEwXzA1OSA9IFBBREw2MTANCiAgICAgIEJDS082MTBfMDU5ID0gQkNLTzYxMA0KICAgIH1lbHNlIGlmKFNQTE02MTAudHJpbSgpIT0iIil7DQogICAgICBNTVMwNTlfTGlzdEFwaUNhbGwoU1BMTTYxMC50cmltKCkpDQogICAgICBQQURMNjEwXzA1OSA9IFBBREw2MTANCiAgICAgIEJDS082MTBfMDU5ID0gQkNLTzYxMCAgICAgIA0KICAgIH0NCiAgICBlbHNlew0KICAgICAgICAgTU1TMDU5X0xpc3RBcGlDYWxsKCIiKQ0KICAgIH0NCg0KICAgICAgaWYoIWxpc3RyZXNwb25zZU1NUzA1OV9MaXN0R2xvYmFsLmlzRW1wdHkoKSl7DQogICAgICBQQURMNjEwXzA1OSA9IGxpc3RyZXNwb25zZU1NUzA1OV9MaXN0R2xvYmFsWzBdLlBBREw7DQogICAgICBCQ0tPNjEwXzA1OSA9IGxpc3RyZXNwb25zZU1NUzA1OV9MaXN0R2xvYmFsWzBdLkJDS087DQogICAgICANCiAgICAgIH0NCiAgICAgIGVsc2UgaWYobGlzdHJlc3BvbnNlTU1TMDU5X0xpc3RHbG9iYWwuaXNFbXB0eSgpKXsNCiAgICAgIG1pLmVycm9yKCJTdXBwbHkgTW9kZWwgIitTUExNNjEwLnRyaW0oKSsiIGRvZXMgbm90IGV4aXN0IHdoaWNoIGlzIGNvbmZpZ3VyZWQgZm9yIGNsaWVudCAiKyBpbkNVTk8udHJpbSgpKQ0KICAgICAgcmV0dXJuDQogICAgICB9ICAgIA0KDQogICAgICAgICAgaWYoaW5ST1VUIT0iIil7DQogICAgICAgICAgRFJTMDA1X0dldFJvdXRlQXBpQ2FsbChpblJPVVQpDQogICAgICAgICAgaWYoIWxpc3RyZXNwb25zZURSUzAwNV9HZXRSb3V0ZUdsb2JhbC5pc0VtcHR5KCkpew0KICAgICAgICAgIH1lbHNlew0KICAgICAgICAgIG1pLmVycm9yKCJSb3V0ZSAiK2luUk9VVCsiIGRvZXMgbm90IGV4aXN0IikgDQogICAgICAgICAgcmV0dXJuDQogICAgICAgICAgfQ0KICAgICAgICAgIA0KICAgICAgICAgIH0gIA0KDQogICAgICAgIHJldHJpZXZlUGxhY2VPZkxvYWRpbmdGcm9tV2FyZWhvdXNlKHdobG8pDQogICAgICAgIGlmKGluUk9VVCE9IiIpew0KICAgICAgICBkZWYgcHJpb3JpdHlSb3V0ID0gdW5pcXVlRGF0YS5maW5kIHsgaXRbIkRSUk9VVCJdLnRvU3RyaW5nKCkudHJpbSgpID09IGluUk9VVCB9DQogICAgICAgIGRlZiBvdGhlclJvdXQgPSB1bmlxdWVEYXRhLmZpbmRBbGwgeyBpdFsiRFJST1VUIl0udG9TdHJpbmcoKS50cmltKCkgIT0gaW5ST1VUIH0NCiAgICAgICAgZGVmIHVuaXF1ZURhdGFQcmlvcml0eSA9IChwcmlvcml0eVJvdXQgPyBbcHJpb3JpdHlSb3V0XSA6IFtdKSArIG90aGVyUm91dA0KICAgICAgICANCg0KICAgICAgICANCiAgICAgICAgdW5pcXVlRGF0YVByaW9yaXR5LmVhY2ggeyBpdGVtIC0+DQogICAgICAgIG1pLm91dERhdGEucHV0KCJURVNUIiwgdW5pcXVlRGF0YVByaW9yaXR5LnRvU3RyaW5nKCkpDQoNCg0KDQoNCg0KICAgICAgICBtaS5vdXREYXRhLnB1dCgiQ1VOTyIsIGluQ1VOTy50cmltKCkpDQogICAgICAgIG1pLm91dERhdGEucHV0KCJPUlRQIiwgT1JUUDYxMC50cmltKCkpDQogICAgICAgIG1pLm91dERhdGEucHV0KCJJVE5PIiwgSVROT3BvcDVvcjQudHJpbSgpKQ0KICAgICAgICBpZihpblBPUDQudHJpbSgpIT0iIil7DQogICAgICAgIG1pLm91dERhdGEucHV0KCJQT1A0IiwgaW5QT1A0LnRyaW0oKSkNCiAgICAgICAgfQ0KICAgICAgICBpZihpblBPUDUudHJpbSgpIT0iIil7DQogICAgICAgIG1pLm91dERhdGEucHV0KCJQT1A1IiwgaW5QT1A1LnRyaW0oKSkNCiAgICAgICAgfQ0KICAgICAgICAvL21pLm91dERhdGEucHV0KCJBVjAxIiwgQVYwMV9NTVMyMDAudHJpbSgpKQ0KICAgICAgICBtaS5vdXREYXRhLnB1dCgiQVYwMSIsIChpdGVtWyJNQkFWQUwiXT8udG9TdHJpbmcoKS50cmltKCkgYXMgRG91YmxlKS0oaXRlbVsiTUJBTFFUIl0/LnRvU3RyaW5nKCkudHJpbSgpIGFzIERvdWJsZSkgYXMgU3RyaW5nKQ0KICAgICAgICBtaS5vdXREYXRhLnB1dCgiQ0ZJMSIsIGluQ0ZJMS50cmltKCkpDQogICAgICAgIGlmKGluT1JRQSE9LTEpew0KICAgICAgICAgIG1pLm91dERhdGEucHV0KCJPUlFBIiwgaW5PUlFBLnRvU3RyaW5nKCkudHJpbSgpKQ0KICAgICAgICB9DQogICAgICAgIG1pLm91dERhdGEucHV0KCJXSExPIiwgaXRlbVsiTVdXSExPIl0/LnRvU3RyaW5nKCkudHJpbSgpKQ0KICAgICAgICBpZihpblNQTE0udHJpbSgpIT0iIil7DQogICAgICAgIG1pLm91dERhdGEucHV0KCJTUExNIiwgaW5TUExNLnRyaW0oKSkNCiAgICAgICAgfQ0KICAgICAgICBlbHNlew0KICAgICAgICAgbWkub3V0RGF0YS5wdXQoIlNQTE0iLCBTUExNNjEwLnRyaW0oKSkgDQogICAgICAgIH0NCg0KICAgICAgbWkub3V0RGF0YS5wdXQoIldITk0iLCBpdGVtWyJNV1dITk0iXT8udG9TdHJpbmcoKS50cmltKCkpDQogICAgICAvL21pLm91dERhdGEucHV0KCJUT01VIiwgVE9NVV9NTVMyMDAudHJpbSgpKQ0KICAgICAgbWkub3V0RGF0YS5wdXQoIlRPTVUiLCAoaXRlbVsiTUJUT01VIl0/LnRvU3RyaW5nKCk/LnRyaW0oKT8udG9Eb3VibGUoKSA/OiAwLjApLmludFZhbHVlKCkudG9TdHJpbmcoKSkNCiAgICAgIG1pLm91dERhdGEucHV0KCJQQURMIiwgUEFETDYxMF8wNTkudHJpbSgpKQ0KICAgICAgbWkub3V0RGF0YS5wdXQoIkJDS08iLCBCQ0tPNjEwXzA1OS50cmltKCkpDQogICAgICBtaS5vdXREYXRhLnB1dCgiVFg0MCIsIGl0ZW1bIkRSVFg0MCJdPy50b1N0cmluZygpLnRyaW0oKSkNCiAgICAgIG1pLm91dERhdGEucHV0KCJST1VUIiwgaXRlbVsiRFJST1VUIl0/LnRvU3RyaW5nKCkudHJpbSgpKQ0KICAgICAgbWkub3V0RGF0YS5wdXQoIkNPRFoiLCBpdGVtWyJEU0RET1ciXT8udG9TdHJpbmcoKS50cmltKCkpDQogICAgICBtaS5vdXREYXRhLnB1dCgiQ09IWiIsICIke2l0ZW1bIkRTQVJISCJdPy50b1N0cmluZygpLnRyaW0oKX0ke2l0ZW1bIkRTQVJNTSJdPy50b1N0cmluZygpLnRyaW0oKX0iKQ0KICAgICAgICAgICAgICBtaS53cml0ZSgpDQogICAgICAgIH0NCiAgICAgICAgfWVsc2UgaWYoaW5PQUxUPT0yKXsNCiAgICAgICAgZGVmIHByaW9yaXR5Um91dCA9IHVuaXF1ZURhdGEuZmluZCB7IGl0WyJEUlJPVVQiXS50b1N0cmluZygpLnRyaW0oKSA9PSBpblJPVVQgfQ0KICAgICAgICBkZWYgb3RoZXJSb3V0ID0gdW5pcXVlRGF0YS5maW5kQWxsIHsgaXRbIkRSUk9VVCJdLnRvU3RyaW5nKCkudHJpbSgpICE9IGluUk9VVCB9DQogICAgICAgIGRlZiB1bmlxdWVEYXRhUHJpb3JpdHkgPSAocHJpb3JpdHlSb3V0ID8gW3ByaW9yaXR5Um91dF0gOiBbXSkgKyBvdGhlclJvdXQNCiAgICAgICAgZGVmIGZpbHRlcmVkQXJyYXkNCiAgICAgICAgaWYodW5pcXVlRGF0YVByaW9yaXR5WzBdKSB7DQogICAgICAgICAgICBkZWYgZmlyc3RFbGVtZW50ID0gdW5pcXVlRGF0YVByaW9yaXR5WzBdDQogICAgICAgICAgICBkZWYgZHNkb3cgPSBmaXJzdEVsZW1lbnRbIkRTRERPVyJdPy50b1N0cmluZygpPy50cmltKCkNCiAgICAgICAgICAgIGRlZiBEU0FSSEggPSBmaXJzdEVsZW1lbnRbIkRTQVJISCJdPy50b1N0cmluZygpPy50cmltKCkNCiAgICAgICAgICAgIGRlZiBEU0FSTU0gPSBmaXJzdEVsZW1lbnRbIkRTQVJNTSJdPy50b1N0cmluZygpPy50cmltKCkNCiAgICAgICAgICAgIGZpbHRlcmVkQXJyYXkgPSB1bmlxdWVEYXRhUHJpb3JpdHkuZmluZEFsbCB7IGl0WyJEU0RET1ciXS50b1N0cmluZygpLnRyaW0oKSA9PSBkc2RvdyAmJiBpdFsiRFNBUkhIIl0udG9TdHJpbmcoKS50cmltKCkgPT0gRFNBUkhIICYmIGl0WyJEU0FSTU0iXS50b1N0cmluZygpLnRyaW0oKSA9PSBEU0FSTU0gfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8gRmlsdGVyIHRoZSBhcnJheSBiYXNlZCBvbiBtYXRjaGluZyBEU0RET1csIERTQVJISCwgYW5kIERTQVJNTSB2YWx1ZXMNCiAgICAgICAgLy9kZWYgZmlsdGVyZWRBcnJheSA9IHVuaXF1ZURhdGFQcmlvcml0eS5maW5kQWxsIHsgaXRbIkRTRERPVyJdLnRvU3RyaW5nKCkudHJpbSgpID09IGRzZG93ICYmIGl0WyJEU0FSSEgiXS50b1N0cmluZygpLnRyaW0oKSA9PSBEU0FSSEggJiYgaXRbIkRTQVJNTSJdLnRvU3RyaW5nKCkudHJpbSgpID09IERTQVJNTSB9DQoNCiAgICAgICAgZmlsdGVyZWRBcnJheS5lYWNoIHsgaXRlbSAtPg0KICAgICAgICAvL3ByaW50bG4gIkRSUk9VVDogJHtpdGVtWyJEUlJPVVQiXX0sIERTRERPVzogJHtpdGVtWyJEU0RET1ciXX0sIERTQVJISDogJHtpdGVtWyJEU0FSSEgiXX0sIERTQVJNTTogJHtpdGVtWyJEU0FSTU0iXX0iDQogICAgICAgIG1pLm91dERhdGEucHV0KCJDVU5PIiwgaW5DVU5PLnRyaW0oKSkNCiAgICAgICAgbWkub3V0RGF0YS5wdXQoIk9SVFAiLCBPUlRQNjEwLnRyaW0oKSkNCiAgICAgICAgbWkub3V0RGF0YS5wdXQoIklUTk8iLCBJVE5PcG9wNW9yNC50cmltKCkpDQogICAgICAgIGlmKGluUE9QNC50cmltKCkhPSIiKXsNCiAgICAgICAgbWkub3V0RGF0YS5wdXQoIlBPUDQiLCBpblBPUDQudHJpbSgpKQ0KICAgICAgICB9DQogICAgICAgIGlmKGluUE9QNS50cmltKCkhPSIiKXsNCiAgICAgICAgbWkub3V0RGF0YS5wdXQoIlBPUDUiLCBpblBPUDUudHJpbSgpKQ0KICAgICAgICB9DQogICAgICAgIC8vbWkub3V0RGF0YS5wdXQoIkFWMDEiLCBBVjAxX01NUzIwMC50cmltKCkpDQogICAgICAgIG1pLm91dERhdGEucHV0KCJBVjAxIiwgKGl0ZW1bIk1CQVZBTCJdPy50b1N0cmluZygpLnRyaW0oKSBhcyBEb3VibGUpLShpdGVtWyJNQkFMUVQiXT8udG9TdHJpbmcoKS50cmltKCkgYXMgRG91YmxlKSBhcyBTdHJpbmcpDQogICAgICAgIG1pLm91dERhdGEucHV0KCJDRkkxIiwgaW5DRkkxLnRyaW0oKSkNCiAgICAgICAgaWYoaW5PUlFBIT0tMSl7DQogICAgICAgICAgbWkub3V0RGF0YS5wdXQoIk9SUUEiLCBpbk9SUUEudG9TdHJpbmcoKS50cmltKCkpDQogICAgICAgIH0NCiAgICAgICAgbWkub3V0RGF0YS5wdXQoIldITE8iLCBpdGVtWyJNV1dITE8iXT8udG9TdHJpbmcoKS50cmltKCkpDQogICAgICAgIGlmKGluU1BMTS50cmltKCkhPSIiKXsNCiAgICAgICAgbWkub3V0RGF0YS5wdXQoIlNQTE0iLCBpblNQTE0udHJpbSgpKQ0KICAgICAgICB9DQogICAgICAgIGVsc2V7DQogICAgICAgICBtaS5vdXREYXRhLnB1dCgiU1BMTSIsIFNQTE02MTAudHJpbSgpKSANCiAgICAgICAgfQ0KICAgICAgbWkub3V0RGF0YS5wdXQoIldITk0iLCBpdGVtWyJNV1dITk0iXT8udG9TdHJpbmcoKS50cmltKCkpDQogICAgICAvL21pLm91dERhdGEucHV0KCJUT01VIiwgVE9NVV9NTVMyMDAudHJpbSgpKQ0KICAgICAgbWkub3V0RGF0YS5wdXQoIlRPTVUiLCAoaXRlbVsiTUJUT01VIl0/LnRvU3RyaW5nKCk/LnRyaW0oKT8udG9Eb3VibGUoKSA/OiAwLjApLmludFZhbHVlKCkudG9TdHJpbmcoKSkNCiAgICAgIG1pLm91dERhdGEucHV0KCJQQURMIiwgUEFETDYxMF8wNTkudHJpbSgpKQ0KICAgICAgbWkub3V0RGF0YS5wdXQoIkJDS08iLCBCQ0tPNjEwXzA1OS50cmltKCkpDQogICAgICBtaS5vdXREYXRhLnB1dCgiVFg0MCIsIGl0ZW1bIkRSVFg0MCJdPy50b1N0cmluZygpLnRyaW0oKSkNCiAgICAgIG1pLm91dERhdGEucHV0KCJST1VUIiwgaXRlbVsiRFJST1VUIl0/LnRvU3RyaW5nKCkudHJpbSgpKQ0KICAgICAgbWkub3V0RGF0YS5wdXQoIlJPRE4iLCBpdGVtWyJEU1JPRE4iXT8udG9TdHJpbmcoKS50cmltKCkpDQogICAgICBtaS5vdXREYXRhLnB1dCgiRFNEVCIsIGl0ZW1bIkRTRFQiXT8udG9TdHJpbmcoKS50cmltKCkpDQogICAgICBtaS5vdXREYXRhLnB1dCgiQ09EWiIsIGl0ZW1bIkRTRERPVyJdPy50b1N0cmluZygpLnRyaW0oKSkNCiAgICAgIG1pLm91dERhdGEucHV0KCJDT0haIiwgIiR7aXRlbVsiRFNBUkhIIl0/LnRvU3RyaW5nKCkudHJpbSgpfSR7aXRlbVsiRFNBUk1NIl0/LnRvU3RyaW5nKCkudHJpbSgpfSIpDQogICAgICBtaS5vdXREYXRhLnB1dCgiRFNITSIsICIke2l0ZW1bIkRTTElMSCJdPy50b1N0cmluZygpLnRyaW0oKX0ke2l0ZW1bIkRTTElMSCJdPy50b1N0cmluZygpLnRyaW0oKX0iKQ0KICAgICAgbWkub3V0RGF0YS5wdXQoIklERVgiLCAiMSIpDQogICAgICBtaS5vdXREYXRhLnB1dCgiSURXSCIsICIxIikNCiAgICAgIG1pLndyaXRlKCkNCiAgICAgICAgfSAgICAgICAgICANCiAgICAgICAgICANCiAgICAgICAgfWVsc2UgaWYoaW5PQUxUPT0wKXsNCiAgICAgICAgICANCg0KICAgICAgIA0KICAgICAgICBkZWYgc29ydGVkRGF0YUJ5V0hMT19ERE9XX0FSSEhfQVJNTSA9IHVuaXF1ZURhdGEuY29sbGVjdCgpLnNvcnQgeyBhLCBiIC0+DQogICAgICAgICAgICAvLyBFbnN1cmUgTVdXSExPIGlzIGNvbXBhcmVkIGFzIGEgU3RyaW5nDQogICAgICAgICAgICBkZWYgcmVzdWx0ID0gKGFbJ01XV0hMTyddIGFzIFN0cmluZykgPD0+IChiWydNV1dITE8nXSBhcyBTdHJpbmcpDQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIElmIE1XV0hMTyBpcyBlcXVhbCwgY29tcGFyZSBEU0RET1cNCiAgICAgICAgICAgIGlmIChyZXN1bHQgPT0gMCkgew0KICAgICAgICAgICAgICAgIGRlZiBkYXRlQSA9IChhWydEU0RET1cnXSBhcyBTdHJpbmcpLnBhZExlZnQoOCwgJzAnKSAvLyBFbnN1cmUgaXQncyBhbiA4LWRpZ2l0IGRhdGUgc3RyaW5nDQogICAgICAgICAgICAgICAgZGVmIGRhdGVCID0gKGJbJ0RTRERPVyddIGFzIFN0cmluZykucGFkTGVmdCg4LCAnMCcpIC8vIEVuc3VyZSBpdCdzIGFuIDgtZGlnaXQgZGF0ZSBzdHJpbmcNCiAgICAgICAgICAgICAgICByZXN1bHQgPSBkYXRlQSA8PT4gZGF0ZUINCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gSWYgRFNERE9XIGlzIGFsc28gZXF1YWwsIGNvbXBhcmUgRFNBUkhIDQogICAgICAgICAgICBpZiAocmVzdWx0ID09IDApIHsNCiAgICAgICAgICAgICAgICBkZWYgaG91cnNBID0gKGFbJ0RTQVJISCddIGFzIEludGVnZXIpLnRvU3RyaW5nKCkucGFkTGVmdCgyLCAnMCcpIC8vIEVuc3VyZSBpdCdzIGEgMi1kaWdpdCBob3VyDQogICAgICAgICAgICAgICAgZGVmIGhvdXJzQiA9IChiWydEU0FSSEgnXSBhcyBJbnRlZ2VyKS50b1N0cmluZygpLnBhZExlZnQoMiwgJzAnKSAvLyBFbnN1cmUgaXQncyBhIDItZGlnaXQgaG91cg0KICAgICAgICAgICAgICAgIHJlc3VsdCA9IGhvdXJzQSA8PT4gaG91cnNCDQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIElmIERTQVJISCBpcyBhbHNvIGVxdWFsLCBjb21wYXJlIERTQVJNTQ0KICAgICAgICAgICAgaWYgKHJlc3VsdCA9PSAwKSB7DQogICAgICAgICAgICAgICAgZGVmIG1pbnV0ZXNBID0gKGFbJ0RTQVJNTSddIGFzIEludGVnZXIpLnRvU3RyaW5nKCkucGFkTGVmdCgyLCAnMCcpIC8vIEVuc3VyZSBpdCdzIGEgMi1kaWdpdCBtaW51dGUNCiAgICAgICAgICAgICAgICBkZWYgbWludXRlc0IgPSAoYlsnRFNBUk1NJ10gYXMgSW50ZWdlcikudG9TdHJpbmcoKS5wYWRMZWZ0KDIsICcwJykgLy8gRW5zdXJlIGl0J3MgYSAyLWRpZ2l0IG1pbnV0ZQ0KICAgICAgICAgICAgICAgIHJlc3VsdCA9IG1pbnV0ZXNBIDw9PiBtaW51dGVzQg0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gcmVzdWx0DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgZGVmIGlkZXhDb3VudGVyID0gMQ0KICAgICAgICBkZWYgbGFzdE1XV0hMTyA9ICcnDQogICAgICAgIA0KICAgICAgICAvL0Fzc2lnbiBJREVYDQogICAgICAgIHNvcnRlZERhdGFCeVdITE9fRERPV19BUkhIX0FSTU0uZWFjaCB7IGl0ZW0gLT4NCiAgICAgICAgICAgIGRlZiBtd1dobG8gPSBpdGVtWydNV1dITE8nXQ0KICAgICAgICANCiAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBNV1dITE8gaXMgdGhlIHNhbWUgYXMgdGhlIGxhc3Qgb25lDQogICAgICAgICAgICBpZiAobXdXaGxvICE9IGxhc3RNV1dITE8pIHsNCiAgICAgICAgICAgICAgICBpZGV4Q291bnRlciA9IDENCiAgICAgICAgICAgICAgICBsYXN0TVdXSExPID0gbXdXaGxvDQogICAgICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAgICAgLy8gQWRkIElERVggZGlyZWN0bHkgdG8gdGhlIGl0ZW0gbWFwDQogICAgICAgICAgICBpdGVtWydJREVYJ10gPSBpZGV4Q291bnRlcg0KICAgICAgICANCiAgICAgICAgICAgIC8vIEluY3JlbWVudCB0aGUgY291bnRlciBmb3IgdGhlIG5leHQgb2NjdXJyZW5jZQ0KICAgICAgICAgICAgaWRleENvdW50ZXIrKw0KICAgICAgICB9DQogICAgICAgIC8vRW5kIG9mIEFzc2lnbiBJREVYDQogICAgICAgICANCiAgICAgICAgDQogICAgICAgIC8vQXNzaWduIElEV0gNCiAgICAgICAgICAvLyBTdGVwIDE6IENyZWF0ZSBhIHNvcnRlZCBjb3B5IG9mIHRoZSBvcmlnaW5hbCBhcnJheSBiYXNlZCBvbiBEU0RET1csIERTQVJISCwgYW5kIERTQVJNTSAod2l0aG91dCBzb3J0aW5nIHRoZSBvcmlnaW5hbCkNCiAgICAgICAgICBkZWYgc29ydGVkRGF0YSA9IHNvcnRlZERhdGFCeVdITE9fRERPV19BUkhIX0FSTU0uY29sbGVjdCB7IGl0IH0gLy8gQ3JlYXRlIGEgc2hhbGxvdyBjb3B5IG9mIHRoZSBvcmlnaW5hbCBhcnJheQ0KICAgICAgICAgIA0KICAgICAgICAgIHNvcnRlZERhdGEuc29ydCB7IGEsIGIgLT4NCiAgICAgICAgICAgICAgKGFbJ0RTRERPVyddIGFzIEludGVnZXIpIDw9PiAoYlsnRFNERE9XJ10gYXMgSW50ZWdlcikgPzogDQogICAgICAgICAgICAgIChhWydEU0FSSEgnXSBhcyBJbnRlZ2VyKSA8PT4gKGJbJ0RTQVJISCddIGFzIEludGVnZXIpID86IA0KICAgICAgICAgICAgICAoYVsnRFNBUk1NJ10gYXMgSW50ZWdlcikgPD0+IChiWydEU0FSTU0nXSBhcyBJbnRlZ2VyKQ0KICAgICAgICAgIH0NCiAgICAgICAgICANCiAgICAgICAgICAvLyBTdGVwIDI6IFJlbW92ZSBkdXBsaWNhdGVzIGJ5IE1XV0hMTyBhbmQgYXNzaWduIElEV0ggc3RhcnRpbmcgZnJvbSAxDQogICAgICAgICAgZGVmIHJlc3VsdCA9IFs6XQ0KICAgICAgICAgIGRlZiBpZHdoQ291bnRlciA9IDENCiAgICAgICAgICANCiAgICAgICAgICBzb3J0ZWREYXRhLmVhY2ggeyBlbnRyeSAtPg0KICAgICAgICAgICAgICBkZWYgbXdobG8gPSBlbnRyeVsnTVdXSExPJ10udG9TdHJpbmcoKQ0KICAgICAgICAgICAgICBpZiAoIXJlc3VsdC5jb250YWluc0tleShtd2hsbykpIHsNCiAgICAgICAgICAgICAgICAgIHJlc3VsdFttd2hsb10gPSBpZHdoQ291bnRlcisrDQogICAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgICAgDQogICAgICAgICAgLy8gU3RlcCAzOiBBZGQgSURXSCB0byBlYWNoIHJlY29yZCBpbiB0aGUgc29ydGVkRGF0YUJ5V0hMT19ERE9XX0FSSEhfQVJNTSBiYXNlZCBvbiBNV1dITE8NCiAgICAgICAgICBzb3J0ZWREYXRhQnlXSExPX0RET1dfQVJISF9BUk1NLmVhY2ggeyByZWNvcmQgLT4NCiAgICAgICAgICAgICAgU3RyaW5nIG13V0hMTyA9IHJlY29yZFsnTVdXSExPJ10udG9TdHJpbmcoKQ0KICAgICAgICAgICAgICBpZiAocmVzdWx0LmNvbnRhaW5zS2V5KG13V0hMTykpIHsNCiAgICAgICAgICAgICAgICAgIHJlY29yZFsnSURXSCddID0gcmVzdWx0W213V0hMT10NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgICANCg0KICAgICAgICAvL0VuZCBvZiBBc3NpZ24gSURXSA0KICAgICAgICANCg0KDQogICAgICAgICAgICAgICAgICANCiAgICAgICAgICANCg0KDQogICAgICAgIHNvcnRlZERhdGFCeVdITE9fRERPV19BUkhIX0FSTU0uZWFjaCB7IGl0ZW0gLT4NCiAgICAgICAgLy9wcmludGxuICJEUlJPVVQ6ICR7aXRlbVsiRFJST1VUIl19LCBEU0RET1c6ICR7aXRlbVsiRFNERE9XIl19LCBEU0FSSEg6ICR7aXRlbVsiRFNBUkhIIl19LCBEU0FSTU06ICR7aXRlbVsiRFNBUk1NIl19Ig0KICAgICAgICBtaS5vdXREYXRhLnB1dCgiQ1VOTyIsIGluQ1VOTy50cmltKCkpDQogICAgICAgIG1pLm91dERhdGEucHV0KCJPUlRQIiwgT1JUUDYxMC50cmltKCkpDQogICAgICAgIG1pLm91dERhdGEucHV0KCJJVE5PIiwgSVROT3BvcDVvcjQudHJpbSgpKQ0KICAgICAgICBpZihpblBPUDQudHJpbSgpIT0iIil7DQogICAgICAgIG1pLm91dERhdGEucHV0KCJQT1A0IiwgaW5QT1A0LnRyaW0oKSkNCiAgICAgICAgfQ0KICAgICAgICBpZihpblBPUDUudHJpbSgpIT0iIil7DQogICAgICAgIG1pLm91dERhdGEucHV0KCJQT1A1IiwgaW5QT1A1LnRyaW0oKSkNCiAgICAgICAgfQ0KICAgICAgICAvL21pLm91dERhdGEucHV0KCJBVjAxIiwgQVYwMV9NTVMyMDAudHJpbSgpKQ0KICAgICAgICBtaS5vdXREYXRhLnB1dCgiQVYwMSIsIChpdGVtWyJNQkFWQUwiXT8udG9TdHJpbmcoKS50cmltKCkgYXMgRG91YmxlKS0oaXRlbVsiTUJBTFFUIl0/LnRvU3RyaW5nKCkudHJpbSgpIGFzIERvdWJsZSkgYXMgU3RyaW5nKQ0KICAgICAgICBtaS5vdXREYXRhLnB1dCgiQ0ZJMSIsIGluQ0ZJMS50cmltKCkpDQogICAgICAgIGlmKGluT1JRQSE9LTEpew0KICAgICAgICAgIG1pLm91dERhdGEucHV0KCJPUlFBIiwgaW5PUlFBLnRvU3RyaW5nKCkudHJpbSgpKQ0KICAgICAgICB9DQogICAgICAgIG1pLm91dERhdGEucHV0KCJXSExPIiwgaXRlbVsiTVdXSExPIl0/LnRvU3RyaW5nKCkudHJpbSgpKQ0KICAgICAgICBpZihpblNQTE0udHJpbSgpIT0iIil7DQogICAgICAgIG1pLm91dERhdGEucHV0KCJTUExNIiwgaW5TUExNLnRyaW0oKSkNCiAgICAgICAgfQ0KICAgICAgICBlbHNlew0KICAgICAgICAgbWkub3V0RGF0YS5wdXQoIlNQTE0iLCBTUExNNjEwLnRyaW0oKSkgDQogICAgICAgIH0NCiAgICAgIG1pLm91dERhdGEucHV0KCJJREVYIiwgaXRlbVsiSURFWCJdIGFzIFN0cmluZykNCiAgICAgIG1pLm91dERhdGEucHV0KCJJRFdIIiwgaXRlbVsiSURXSCJdIGFzIFN0cmluZykNCiAgICAgIG1pLm91dERhdGEucHV0KCJXSE5NIiwgaXRlbVsiTVdXSE5NIl0/LnRvU3RyaW5nKCkudHJpbSgpKQ0KICAgICAvLyBtaS5vdXREYXRhLnB1dCgiVE9NVSIsIFRPTVVfTU1TMjAwLnRyaW0oKSkNCiAgICAgIG1pLm91dERhdGEucHV0KCJUT01VIiwgKGl0ZW1bIk1CVE9NVSJdPy50b1N0cmluZygpPy50cmltKCk/LnRvRG91YmxlKCkgPzogMC4wKS5pbnRWYWx1ZSgpLnRvU3RyaW5nKCkpDQogICAgICBtaS5vdXREYXRhLnB1dCgiUEFETCIsIFBBREw2MTBfMDU5LnRyaW0oKSkNCiAgICAgIG1pLm91dERhdGEucHV0KCJCQ0tPIiwgQkNLTzYxMF8wNTkudHJpbSgpKQ0KICAgICAgbWkub3V0RGF0YS5wdXQoIlRYNDAiLCBpdGVtWyJEUlRYNDAiXT8udG9TdHJpbmcoKS50cmltKCkpDQogICAgICBtaS5vdXREYXRhLnB1dCgiUk9VVCIsIGl0ZW1bIkRSUk9VVCJdPy50b1N0cmluZygpLnRyaW0oKSkNCiAgICAgIG1pLm91dERhdGEucHV0KCJEU0RUIiwgaXRlbVsiRFNEVCJdPy50b1N0cmluZygpLnRyaW0oKSkNCiAgICAgIG1pLm91dERhdGEucHV0KCJST0ROIiwgaXRlbVsiRFNST0ROIl0/LnRvU3RyaW5nKCkudHJpbSgpKQ0KICAgICAgbWkub3V0RGF0YS5wdXQoIkNPRFoiLCBpdGVtWyJEU0RET1ciXT8udG9TdHJpbmcoKS50cmltKCkpDQogICAgICBtaS5vdXREYXRhLnB1dCgiQ09IWiIsICIke2l0ZW1bIkRTQVJISCJdPy50b1N0cmluZygpLnRyaW0oKX0ke2l0ZW1bIkRTQVJNTSJdPy50b1N0cmluZygpLnRyaW0oKX0iKQ0KICAgICAgbWkub3V0RGF0YS5wdXQoIkRTSE0iLCAiJHtpdGVtWyJEU0xJTEgiXT8udG9TdHJpbmcoKS50cmltKCl9JHtpdGVtWyJEU0xJTE0iXT8udG9TdHJpbmcoKS50cmltKCl9IikNCiAgICAgIG1pLm91dERhdGEucHV0KCJURVNUIiwgc29ydGVkRGF0YUJ5V0hMT19ERE9XX0FSSEhfQVJNTS50b1N0cmluZygpKQ0KICAgICAgbWkud3JpdGUoKQ0KICAgICAgICB9DQogICAgICAgIA0KDQogICAgICAgIA0KICAgICAgICANCiAgICAgICAgfQ0KDQogICAgfQ0KICAgICAgICANCn0NCg=="}}}